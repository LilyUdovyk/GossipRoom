{"version":3,"sources":["components/AttachmentLink/style.module.css","components/Profile/style.module.css","components/NewMessageCounter/style.module.css","components/Main/style.module.css","components/ChatWindow/style.module.css","history.ts","store/auth/actions.ts","store/auth/reducers.ts","store/user/actions.ts","store/user/reducers.ts","store/contacts/actions.ts","store/contacts/reducers.ts","store/chat/actions.ts","store/chat/reducers.ts","store/message/actions.ts","store/message/reducers.ts","store/media/actions.ts","store/media/reducers.ts","store/rootReducer.ts","dataPost.ts","store/auth/sagas.ts","store/user/sagas.ts","store/contacts/sagas.ts","store/chat/sagas.ts","store/message/sagas.ts","store/media/sagas.ts","store/rootSaga.ts","components/Registration/index.tsx","components/Authorization/index.tsx","components/NewMessageCounter/index.tsx","components/User/index.tsx","components/ButtonWithPopup/index.tsx","components/Sidebar/index.tsx","components/Empty/index.tsx","components/Header/index.tsx","components/AttachmentLink/index.tsx","components/FormattedMessage/index.tsx","components/ForwardingBlock/index.tsx","components/MessageMenu/index.tsx","components/Chat/index.tsx","components/ButtonWithEmoji/index.tsx","components/ButtonWithFileUpload/index.tsx","components/OriginalMessageBlock/index.tsx","components/MessageInput/index.tsx","components/ChatWindow/index.tsx","components/Main/index.tsx","components/Profile/index.tsx","components/CreationNewChat/index.tsx","Routes.tsx","App.tsx","serviceWorker.ts","index.tsx","img/user_avatar.png","components/ButtonWithPopup/style.module.css","components/CreationNewChat/style.module.css","components/Registration/style.module.css","components/Chat/style.module.css","components/ButtonWithFileUpload/style.module.css","components/Authorization/style.module.css","components/MessageMenu/style.module.css","components/MessageInput/style.module.css","components/User/style.module.css","components/Sidebar/style.module.css","components/Empty/style.module.css","components/FormattedMessage/style.module.css","components/OriginalMessageBlock/style.module.css","img/chat_avatar.png","components/Header/style.module.css","components/ForwardingBlock/style.module.css","components/ButtonWithEmoji/style.module.css"],"names":["module","exports","history","createBrowserHistory","authByCreds","createAsyncAction","regByCreds","logout","createAction","initialState","authData","authToken","id","login","error","getUser","updateAvatar","userData","_id","createdAt","nick","avatar","url","chats","getContacts","contactsData","getActiveChat","addChat","addGroup","activeChatId","activeChatName","chatData","owner","title","members","messages","sendMessage","onMessage","message","saveOriginalMessage","savedMessage","replyToMessage","forwardMessage","originalMessage","isReply","isForward","messageData","chat","text","media","replies","replyTo","forwarded","forwardWith","uploadFile","fileData","mediaData","originalFileName","type","userAvatar","chatAvatar","rootReducer","combineReducers","router","connectRouter","auth","state","action","getType","actions","success","payload","failure","user","contacts","activeChat","newChat","dataPost","Authorization","query","variables","a","fetch","method","headers","body","JSON","stringify","response","result","json","ok","Error","authByCredsSaga","regByCredsSaga","logoutSaga","localStorage","getItem","decoded","jwtDecode","sub","putResolve","put","push","take","request","call","getAuthToken","password","setItem","Promise","res","setTimeout","loginContent","data","regUser","regContent","UserUpsert","clear","getUserSaga","updateAvatarSaga","select","userId","getActiveUser","userQuery","getActiveUserQuery","activeUserQuery","userContent","UserFindOne","user_id","image_id","updateAvatarQuery","getContactsSaga","getContactsList","сontacts","сontactsContent","UserFind","getActiveChatSaga","addChatSaga","addGroupSaga","activeUserId","getNameOfChat","chatQuery","getActiveChatQuery","chatId","activeChatQuery","chatContent","ChatFindOne","length","map","member","join","find","addNewChat","addNewChatQuery","firstMember_id","secondMember_id","newChatContent","ChatUpsert","addNewGroup","chatTitle","addNewGroupQuery","membersQuery","newGroupContent","sendMessageSaga","onMessageSaga","replyToMessageSaga","forwardMessageSaga","mediaId","sendMessageacWithAtthment","messageQuery","sendMessageQuery","chat_id","messageContent","MessageUpsert","sendMessageWithAtthmentQuery","media_id","playSound","Audio","play","originalMessageId","replyToMessageQuery","forwardMessageQuery","uploadFileSaga","getFileData","form","FormData","rootSaga","all","spawn","connect","authError","dispatch","bindActionCreators","authActions","React","memo","props","useState","setNick","setLogin","setPassword","password2","setPassword2","passwordError","setPasswordError","className","style","container","card","header","onSubmit","e","preventDefault","formControl","htmlFor","required","value","onChange","target","submitBtn","to","counter","setCounter","chatIdWithNewMessage","newMessage","useEffect","onClick","src","avatarSrc","alt","userImg","userDetails","useDetailsName","name","ButtonWithPopup","isOpenedPopup","isAvatarUpload","myRef","createRef","myFormRef","closePopup","event","current","contains","setState","togglePopup","uploadAvatar","logoutHandler","prevProps","prevState","this","document","addEventListener","removeEventListener","buttonWithPopup","navOpener","icon","ref","popup","popupHeader","imageId","imageUrl","uploadForm","encType","uploadBtnWrapper","changeButton","uploadInput","okButton","navSidebar","navList","navItem","PureComponent","mediaActions","userActions","contactsActions","chatActions","sidebarView","setSidebarView","getDetailsOfChat","details","nameFromMember","memberAvatar","checkMemberInChats","contactId","contactsChats","forEach","sidebar","buttonBlock","navButton","key","contact","empty","emptyName","emptyInfo","headerName","settingsButton","href","attachmentLink","size","fileIcon","videoArray","match","videoId","width","frameBorder","allow","allowFullScreen","encrypted-media","picture-in-picture","mediaAttachment","attachment","controls","includes","urls","getUrls","parsedUrls","Array","from","idx","parseURLs","messageActions","useRef","closeForwardBlock","deleteOriginalMessage","groupTitleFromMember","forwardingContainer","containerHeader","containerTitle","isVisibleMenu","setIsVisibleMenu","classnames","messageMenu","invisible","menuList","menuItem","mediaUrl","chatsRef","scrollToBottom","scrollTop","scrollHeight","isUserMsg","replyBlock","forwardedBlock","timeBlock","moment","format","ButtonWithEmoji","closeEmoji","isOpenedEmoji","toggleEmoji","emojiObj","buttonWithEmoji","button","emojiBlock","set","onSelect","emoji","addEmoji","ButtonWithFileUpload","isOpenedFileUpload","fileMessage","fileAttachmentRef","closeFileUpload","toggleFileUpload","sendAttachment","fileId","buttonWithFileUpload","paperclipButton","dialogContainer","dialogHeader","dialogForm","dialogLabel","dialogInput","autoFocus","placeholder","originalMessageBlock","setText","messageBlock","native","trim","messageForm","messageInput","chatWindow","main","socket","io","emit","on","console","log","profile","activeUser","defaultMembers","setChatTitle","setMembers","titleInput","users","addMemberHandler","exact","path","component","Registration","Profile","CreationNewChat","render","library","add","faSmile","faPaperclip","faPaperPlane","faBars","faUserFriends","faComments","faSignOutAlt","faFileAlt","faFileArchive","faFile","faFileVideo","faFileAudio","faTimes","faCheckCircle","faExclamationCircle","faReply","faShare","sagaMiddleware","createSagaMiddleware","store","createStore","applyMiddleware","routerMiddleware","run","App","Boolean","window","location","hostname","ReactDOM","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch"],"mappings":"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","file":"static/js/main.ce168e48.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"attachmentLink\":\"style_attachmentLink__DNDkC\",\"fileIcon\":\"style_fileIcon__1WFEO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"profile\":\"style_profile__2a_cU\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"counter\":\"style_counter__1moC1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"style_main__F82O7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"chatWindow\":\"style_chatWindow__14ABs\"};","import { createBrowserHistory } from \"history\";\r\n\r\nexport const history = createBrowserHistory()","import { createAction, createAsyncAction } from \"typesafe-actions\";\r\nimport { AuthCreds, RegCreds, AuthSuccessData } from \"./types\";\r\n\r\nexport const authByCreds = createAsyncAction(\r\n    \"auth/AUTH_BY_CREDS_REQUEST\",\r\n    \"auth/AUTH_BY_CREDS_SUCCESS\",\r\n    \"auth/AUTH_BY_CREDS_FAILURE\"\r\n)<AuthCreds, AuthSuccessData, string>();\r\n\r\nexport const regByCreds = createAsyncAction(\r\n    \"auth/REG_BY_CREDS_REQUEST\",\r\n    \"auth/REG_BY_CREDS_SUCCESS\",\r\n    \"auth/REG_BY_CREDS_FAILURE\"\r\n)<RegCreds, AuthSuccessData, string>();\r\n\r\nexport const logout = createAction(\r\n    \"auth/LOGOUT\"\r\n)();","import { getType } from \"typesafe-actions\";\r\n\r\nimport { AuthState, AuthAction } from \"./types\";\r\nimport * as actions from \"./actions\";\r\n\r\nconst initialState: AuthState = {\r\n    authData: {\r\n        authToken: null,\r\n        id: '',\r\n        login: '',\r\n        error: null\r\n    }\r\n}\r\n\r\nexport default (state: AuthState = initialState, action: AuthAction): AuthState => {\r\n    switch (action.type) {\r\n        case getType(actions.authByCreds.success):\r\n            return {\r\n                ...state, \r\n                authData: {\r\n                    ...state.authData, \r\n                    authToken: action.payload.authToken, \r\n                    id: action.payload.id, \r\n                    login: action.payload.login, \r\n                    error: null\r\n                } \r\n            }\r\n        case getType(actions.authByCreds.failure):\r\n            return {\r\n                ...state,\r\n                authData: {\r\n                    ...state.authData,\r\n                    authToken: null,\r\n                    error: action.payload\r\n                }\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}","import { createAsyncAction } from \"typesafe-actions\";\r\nimport { UserData, UpdateAvatarCreds } from \"../user/types\";\r\n\r\nexport const getUser = createAsyncAction(\r\n    \"user/GET_USER_REQUEST\",\r\n    \"user/GET_USER_SUCCESS\",\r\n    \"user/GET_USER_FAILURE\"\r\n)<void, UserData, string>();\r\n\r\n\r\nexport const updateAvatar = createAsyncAction(\r\n    \"media/UPDATE_AVATAR_REQUEST\",\r\n    \"media/UPDATE_AVATAR_SUCCESS\",\r\n    \"media/UPDATE_AVATAR_FAILURE\"\r\n)<UpdateAvatarCreds, UserData, string>();","import { getType } from \"typesafe-actions\";\r\n\r\nimport { UserState, UserAction } from \"./types\";\r\nimport * as actions from \"./actions\";\r\n\r\nconst initialState: UserState = {\r\n    error: null,\r\n    userData: {\r\n        _id: '',\r\n        createdAt: '',\r\n        login: '',\r\n        nick : '',\r\n        avatar: {\r\n            _id: '',\r\n            url: ''\r\n        },\r\n        chats: []\r\n    }\r\n}\r\n\r\nexport default (state: UserState = initialState, action: UserAction): UserState => {\r\n    switch (action.type) {\r\n        case getType(actions.getUser.success):\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                userData: action.payload\r\n            }\r\n        case getType(actions.getUser.failure):\r\n            return {\r\n                ...state,\r\n                error: action.payload,\r\n            }\r\n        case getType(actions.updateAvatar.success):\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                userData: action.payload\r\n            }\r\n        case getType(actions.updateAvatar.failure):\r\n            return {\r\n                ...state,\r\n                error: action.payload,\r\n            }    \r\n        default:\r\n            return state\r\n    }\r\n}","import { createAsyncAction, createAction } from \"typesafe-actions\";\r\nimport { UserData } from \"../user/types\";\r\n\r\nexport const getContacts = createAsyncAction(\r\n    \"contacts/GET_CONTACTS_REQUEST\",\r\n    \"contacts/GET_CONTACTS_SUCCESS\",\r\n    \"contacts/GET_CONTACTS_FAILURE\"\r\n)<void, UserData[], string>();","import { getType } from \"typesafe-actions\";\r\n\r\nimport { ContactsState, ContactsAction } from \"./types\";\r\nimport * as actions from \"./actions\";\r\n\r\nconst initialState: ContactsState = {\r\n    error: null,\r\n    contactsData: []\r\n}\r\n\r\nexport default (state: ContactsState = initialState, action: ContactsAction): ContactsState => {\r\n    switch (action.type) {\r\n        case getType(actions.getContacts.success):\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                contactsData:[\r\n                    ...state.contactsData,\r\n                    ...action.payload\r\n                ]\r\n            }\r\n        case getType(actions.getContacts.failure):\r\n            return {\r\n                ...state,\r\n                contactsData:[],\r\n                error: action.payload,\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}","import { createAsyncAction } from \"typesafe-actions\";\r\nimport { ChatSuccessData, AddChatSuccessData, AddGroupCreds } from \"./types\";\r\n\r\nexport const getActiveChat = createAsyncAction(\r\n    \"chat/GET_ACTIVE_CHAT_REQUEST\",\r\n    \"chat/GET_ACTIVE_CHAT_SUCCESS\",\r\n    \"chat/GET_ACTIVE_CHAT_FAILURE\"\r\n)<string, ChatSuccessData, string>();\r\n\r\nexport const addChat = createAsyncAction(\r\n    \"chat/ADD_CHAT_REQUEST\",\r\n    \"chat/ADD_CHAT_SUCCESS\",\r\n    \"chat/ADD_CHAT_FAILURE\"\r\n)<string, AddChatSuccessData, string>();\r\n\r\nexport const addGroup = createAsyncAction(\r\n    \"chat/ADD_GROUP_REQUEST\",\r\n    \"chat/ADD_GROUP_SUCCESS\",\r\n    \"chat/ADD_GROUP_FAILURE\"\r\n)<AddGroupCreds, AddChatSuccessData, string>();","import { getType } from \"typesafe-actions\";\r\n\r\nimport { ChatState, ChatAction } from \"./types\";\r\nimport * as actions from \"./actions\";\r\n\r\nconst initialState: ChatState = {\r\n    activeChatId: null,\r\n    activeChatName: \"Chat\",\r\n    error: null,\r\n    chatData: {\r\n        _id: '',\r\n        owner: {\r\n            _id: '',\r\n            login: '',\r\n            nick : '',\r\n            avatar: {\r\n                _id: '',\r\n                url: ''\r\n            }\r\n        },\r\n        title: '',\r\n        createdAt: '',\r\n        members: [],\r\n        messages: [],\r\n        avatar: {\r\n            _id: '',\r\n            url: ''\r\n        }\r\n    }\r\n}\r\n\r\nexport default (state: ChatState = initialState, action: ChatAction): ChatState => {\r\n    switch (action.type) {\r\n        case getType(actions.getActiveChat.success):\r\n            return {\r\n                ...state,\r\n                activeChatId: action.payload.activeChatId,\r\n                activeChatName: action.payload.activeChatName,\r\n                error: null,\r\n                chatData: action.payload.activeChat\r\n            }\r\n        case getType(actions.getActiveChat.failure):\r\n            return {\r\n                ...state,\r\n                error: action.payload,\r\n            }\r\n        case getType(actions.addChat.success):\r\n            return {\r\n                ...state,\r\n                activeChatId: action.payload.activeChatId,\r\n                error: null,\r\n                chatData: action.payload.newChat\r\n            }\r\n        case getType(actions.addChat.failure):\r\n            return {\r\n                ...state,\r\n                error: action.payload,\r\n            }\r\n        case getType(actions.addGroup.success):\r\n            return {\r\n                ...state,\r\n                activeChatId: action.payload.activeChatId,\r\n                error: null,\r\n                chatData: action.payload.newChat\r\n            }\r\n        case getType(actions.addGroup.failure):\r\n            return {\r\n                ...state,\r\n                error: action.payload,\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}","import { createAsyncAction, createAction } from \"typesafe-actions\";\r\nimport { MessageCreds, MessageData, ReplyCreds, SavedMessageData } from \"./types\";\r\n\r\nexport const sendMessage = createAsyncAction(\r\n    \"message/SEND_MESSAGE_REQUEST\",\r\n    \"message/SEND_MESSAGE_SUCCESS\",\r\n    \"message/SEND_MESSAGE_FAILURE\"\r\n)<MessageCreds, MessageData, string>();\r\n\r\nexport const onMessage = createAction(\r\n    \"message/ON_MESSAGE\", (message: MessageData) => message\r\n)();\r\n\r\nexport const saveOriginalMessage = createAction(\r\n    \"message/SAVE_ORIGINAL_MESSAGE\", (savedMessage: SavedMessageData) => savedMessage\r\n)();\r\n\r\nexport const replyToMessage = createAsyncAction(\r\n    \"message/REPLY_TO_MESSAGE_REQUEST\",\r\n    \"message/REPLY_TO_MESSAGE_SUCCESS\",\r\n    \"message/REPLY_TO_MESSAGE_FAILURE\"\r\n)<ReplyCreds, MessageData, string>();\r\n\r\nexport const forwardMessage = createAsyncAction(\r\n    \"message/FORWARD_MESSAGE_REQUEST\",\r\n    \"message/FORWARD_MESSAGE_SUCCESS\",\r\n    \"message/FORWARD_MESSAGE_FAILURE\"\r\n)<ReplyCreds, MessageData, string>();\r\n","import { getType } from \"typesafe-actions\";\r\n\r\nimport { MessageState, MessageAction } from \"./types\";\r\nimport * as actions from \"./actions\";\r\n\r\nconst initialState: MessageState = {\r\n    error: null,\r\n    savedMessage: {\r\n        originalMessage: null,\r\n        isReply: false,\r\n        isForward: false,\r\n    },\r\n    messageData: {\r\n        _id: '',\r\n        createdAt: '',\r\n        owner: {\r\n            _id: '',\r\n            login: '',\r\n            nick : '',\r\n            avatar: {\r\n                _id: '',\r\n                url: ''\r\n            }\r\n        },\r\n        chat: {\r\n            _id: '',\r\n            owner: {\r\n                _id: '',\r\n                login: '',\r\n                nick : '',\r\n                avatar: {\r\n                    _id: '',\r\n                    url: ''\r\n                }\r\n            },\r\n            title: '',\r\n            createdAt: '',\r\n            members: [],\r\n            messages: [],\r\n            avatar: {\r\n                _id: '',\r\n                url: ''\r\n            }\r\n        },\r\n        text: '',\r\n        media:[],\r\n        replies: [],\r\n        replyTo: {\r\n            _id: '',\r\n            text: '',\r\n            media: [],\r\n            owner: {\r\n                _id: '',\r\n                login: '',\r\n                nick : ''\r\n            }\r\n        },\r\n        forwarded: {\r\n            _id: '',\r\n            text: '',\r\n            media: [],\r\n            owner: {\r\n                _id: '',\r\n                login: '',\r\n                nick : ''\r\n            }\r\n        },\r\n        forwardWith: []\r\n    }\r\n}\r\n\r\nexport default (state: MessageState = initialState, action: MessageAction): MessageState => {\r\n    switch (action.type) {\r\n        case getType(actions.sendMessage.success):\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                messageData: action.payload,\r\n            }\r\n        case getType(actions.sendMessage.failure):\r\n            return {\r\n                ...state,\r\n                error: action.payload,\r\n            }\r\n        case getType(actions.onMessage):\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                messageData: action.payload,\r\n            }\r\n        case getType(actions.saveOriginalMessage):\r\n            return {\r\n                ...state,\r\n                error: null, \r\n                savedMessage: {\r\n                    ...state.savedMessage,\r\n                    originalMessage: action.payload.originalMessage,\r\n                    isReply: action.payload.isReply,\r\n                    isForward: action.payload.isForward\r\n                }\r\n            }\r\n        case getType(actions.replyToMessage.success):\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                messageData: action.payload,\r\n                savedMessage: {\r\n                    ...state.savedMessage,\r\n                    originalMessage: null,\r\n                    isReply: false\r\n                }               \r\n            }\r\n        case getType(actions.replyToMessage.failure):\r\n            return {\r\n                ...state,\r\n                error: action.payload,\r\n            }\r\n        case getType(actions.forwardMessage.success):\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                messageData: action.payload,\r\n                savedMessage: {\r\n                    ...state.savedMessage,\r\n                    originalMessage: null,\r\n                    isForward: false\r\n                }\r\n            }\r\n        case getType(actions.forwardMessage.failure):\r\n            return {\r\n                ...state,\r\n                error: action.payload,\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}","import { createAsyncAction } from \"typesafe-actions\";\r\nimport { FileData } from \"./types\";\r\n\r\nexport const uploadFile = createAsyncAction(\r\n    \"media/UPLOAD_FILE_REQUEST\",\r\n    \"media/UPLOAD_FILE_SUCCESS\",\r\n    \"media/UPLOAD_FILE_FAILURE\"\r\n)<HTMLFormElement, FileData, string>();","import { getType } from \"typesafe-actions\";\r\n\r\nimport { MediaState, MediaAction } from \"./types\";\r\nimport * as actions from \"./actions\";\r\n\r\nconst initialState: MediaState = {\r\n    error: null,\r\n    fileData: {\r\n        _id: null,\r\n        url: null\r\n    },\r\n    mediaData: {\r\n        _id: '',\r\n        createdAt: '',\r\n        owner: {\r\n            _id: '',\r\n            login: '',\r\n            nick : '',\r\n            avatar: {\r\n                _id: '',\r\n                url: ''\r\n            }\r\n        },\r\n        text: '',\r\n        url: '',\r\n        originalFileName: '',\r\n        type: '',\r\n        userAvatar: {\r\n            _id: '',\r\n            login: '',\r\n            nick : '',\r\n            avatar: {\r\n                _id: '',\r\n                url: ''\r\n            }\r\n        },\r\n        chatAvatar: [],\r\n        messages: []\r\n    }\r\n}\r\n\r\nexport default (state: MediaState = initialState, action: MediaAction): MediaState => {\r\n    switch (action.type) {\r\n        case getType(actions.uploadFile.success):\r\n            return {\r\n                ...state,\r\n                error: null,\r\n                fileData: action.payload\r\n            }\r\n        case getType(actions.uploadFile.failure):\r\n            return {\r\n                ...state,\r\n                error: action.payload,\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}","import { combineReducers } from \"redux\";\r\nimport { EmptyAction, StateType } from \"typesafe-actions\";\r\nimport { connectRouter } from \"connected-react-router\";\r\nimport { history } from \"../history\";\r\n\r\nimport { AuthAction } from \"./auth/types\";\r\nimport authReducer from './auth/reducers'\r\nimport { UserAction } from \"./user/types\";\r\nimport userReducer from './user/reducers'\r\nimport { ContactsAction } from \"./contacts/types\";\r\nimport contactsReducer from './contacts/reducers'\r\nimport { ChatAction } from \"./chat/types\";\r\nimport chatReducer from './chat/reducers'\r\nimport { MessageAction } from \"./message/types\";\r\nimport messageReducer from './message/reducers'\r\nimport { MediaAction } from \"./media/types\";\r\nimport mediaReducer from './media/reducers'\r\n\r\nconst rootReducer = combineReducers({\r\n    router: connectRouter(history),\r\n    auth: authReducer,\r\n    user: userReducer,\r\n    contacts: contactsReducer,\r\n    chat: chatReducer,\r\n    message: messageReducer,\r\n    media: mediaReducer\r\n})\r\n\r\nexport type IRootState = StateType<typeof rootReducer>\r\nexport type IRootAction = AuthAction \r\n                        | UserAction \r\n                        | ContactsAction \r\n                        | ChatAction \r\n                        | MessageAction\r\n                        | MediaAction\r\n                        | EmptyAction<string>\r\n\r\nexport default rootReducer","import { UserData } from './store/user/types';\n\ninterface variablesData {\n    \"login\"?: string\n    \"password\"?: string\n    \"nick\"?: string\n    \"activeUserQuery\"?: string\n    \"activeChatQuery\"?: string\n    \"chat_id\"?: string\n    \"text\"?: string\n    \"firstMember_id\"?: string\n    \"secondMember_id\"?: string\n    \"user_id\"?: string\n    \"image_id\"?: string\n    \"media_id\"?: string\n    \"message_id\"?: string\n    \"chat_title\"?: string,\n    \"members\"?: { \"_id\": string; }[]\n}\n\nexport const dataPost = async (url: string, Authorization: string, query: string, variables?: variablesData) => {\n    try {\n        const response = await fetch(url, {\n            method: 'post',\n            headers: {\n                'Content-Type': 'application/json',\n                'Accept': 'application/json',\n                'Authorization': Authorization\n            },\n            body: JSON.stringify({\n                query: query,\n                variables: variables\n            })\n        });\n        const result = response.json();\n        return response.ok ? result : new Error('Status is not 200')\n    } catch (error) {\n        return new Error('dataPost failed')\n    }\n}","import { take, call, put, putResolve } from 'redux-saga/effects';\r\nimport { push } from 'connected-react-router';\r\nimport jwtDecode from \"jwt-decode\";\r\n\r\nimport * as actions from './actions'\r\nimport { DecodedToken } from './types'\r\nimport { dataPost } from '../../dataPost'\r\n\r\nexport function* authByCredsSaga() {\r\n    const authToken = localStorage.getItem('authToken')\r\n    if (authToken) {\r\n        const decoded: DecodedToken = jwtDecode(authToken);\r\n        const id = decoded.sub.id\r\n        const login = decoded.sub.login\r\n        yield putResolve(actions.authByCreds.success({authToken, id, login}))\r\n        yield put(push('/profile'))\r\n    }\r\n    while (true) {\r\n        const { payload } = yield take(actions.authByCreds.request)\r\n        try {\r\n            const authToken = yield call(getAuthToken, payload.login, payload.password)\r\n            if (authToken) {\r\n                const decoded: DecodedToken = jwtDecode(authToken)\r\n                const id = decoded.sub.id\r\n                const login = decoded.sub.login\r\n                localStorage.setItem('authToken', authToken)\r\n                yield putResolve(actions.authByCreds.success({ authToken, id, login }))\r\n                yield put(push('/profile'))\r\n            } else {\r\n                yield put(actions.authByCreds.failure('Wrong login or password'))\r\n            }\r\n        } catch (error) {\r\n            yield put(actions.authByCreds.failure(error.message))\r\n        }\r\n    }\r\n}\r\n\r\nconst logInQuery = `query log ($login:String, $password:String) {\r\n        login(login:$login, password:$password)\r\n    }`\r\n\r\nconst getAuthToken = async (login: string, password: string) => {\r\n    await new Promise((res) => setTimeout(res, 1000))\r\n    let loginContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', '', logInQuery, \r\n        {\r\n            \"login\": login,\r\n            \"password\": password\r\n        })\r\n    return loginContent.data.login\r\n}\r\n\r\nexport function* regByCredsSaga() {\r\n    while (true) {\r\n        const { payload } = yield take(actions.regByCreds.request)\r\n        try {\r\n            const user = yield call(regUser, payload.nick, payload.login, payload.password)\r\n            const authToken = yield call(getAuthToken, payload.login, payload.password)\r\n            if (authToken) {\r\n                const decoded: DecodedToken = jwtDecode(authToken)\r\n                const id = decoded.sub.id\r\n                const login = decoded.sub.login\r\n                localStorage.setItem('authToken', authToken)\r\n                yield putResolve(actions.authByCreds.success({ authToken, id, login }))\r\n                yield put(push('/profile'))\r\n            } \r\n            else {\r\n                yield put(actions.authByCreds.failure(`User ${payload.login} already exists`))\r\n            }\r\n        } catch (error) {\r\n            yield put(actions.regByCreds.failure(error.message))\r\n        }\r\n    }\r\n}\r\n\r\nconst registrationQuery = `mutation reg($nick:String, $login:String, $password:String) {\r\n    UserUpsert(user: {nick:$nick, login:$login, password:$password}) {\r\n        _id createdAt login nick\r\n        avatar{\r\n            _id, url\r\n        }\r\n    }\r\n}`\r\n\r\nconst regUser = async (nick: string, login: string, password: string) => {\r\n    await new Promise((res) => setTimeout(res, 1000))\r\n    let regContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', '', registrationQuery,\r\n        {\r\n            \"nick\": nick,\r\n            \"login\": login,\r\n            \"password\": password\r\n        }  \r\n    )\r\n    return regContent.data.UserUpsert\r\n}\r\n\r\nexport function* logoutSaga() {\r\n    while (true) {\r\n        yield take(actions.logout)\r\n        localStorage.clear();\r\n        yield put(push('/sign-in'))\r\n    }\r\n}","import { take, call, put, putResolve, select } from 'redux-saga/effects';\r\n\r\nimport * as actions from './actions'\r\nimport { dataPost } from '../../dataPost'\r\n\r\nexport function* getUserSaga() {\r\n  while (true) {\r\n    yield take(actions.getUser.request)\r\n    try {\r\n      const userId = yield select(state => state.auth.authData.id)\r\n      const user = yield call(getActiveUser, userId)\r\n      yield putResolve(actions.getUser.success(user))\r\n    } catch (error) {\r\n      yield put(actions.getUser.failure(error.message))\r\n    }\r\n  }\r\n}\r\n\r\nconst userQuery = \r\n`{\r\n  _id\r\n  login\r\n  nick\r\n  createdAt\r\n  avatar{\r\n    _id, url\r\n  }\r\n  chats{\r\n    _id\r\n    createdAt\r\n    title\r\n    owner{\r\n      _id login nick\r\n      avatar{\r\n        _id, url\r\n      }\r\n    }\r\n    members{\r\n      _id login nick\r\n      avatar{\r\n        _id, url\r\n      }\r\n    }\r\n    messages{\r\n      _id createdAt text\r\n      owner{\r\n        _id login nick\r\n        avatar{\r\n          _id, url\r\n        }\r\n      }\r\n    }\r\n    avatar{\r\n      _id, url\r\n    }\r\n  }\r\n}`\r\n\r\nconst getActiveUserQuery = `query getUsers($activeUserQuery: String){\r\n  UserFindOne(query: $activeUserQuery)\r\n  ${userQuery}\r\n}`\r\n\r\nconst getActiveUser = async (userId: string) => {\r\n  const activeUserQuery = `[{\"_id\": \"${userId}\"}]`\r\n  let userContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', \r\n    `Bearer ${localStorage.authToken}`,\r\n    getActiveUserQuery,\r\n    {\r\n      \"activeUserQuery\": activeUserQuery\r\n    }\r\n  )\r\n  return userContent.data.UserFindOne\r\n}\r\n\r\nexport function* updateAvatarSaga() {\r\n  while (true) {\r\n    const { payload } = yield take(actions.updateAvatar.request)\r\n    try {\r\n      const userData = yield call(updateAvatar, payload.user_id, payload.image_id)\r\n      yield putResolve(actions.updateAvatar.success(userData))\r\n    } catch (error) {\r\n      yield put(actions.updateAvatar.failure(error.message))\r\n    }\r\n  }\r\n}\r\n\r\nconst updateAvatarQuery = `mutation updateAvatar($user_id: ID, $image_id: ID) {\r\n  UserUpsert(user: {_id: $user_id, \r\n    avatar: {_id: $image_id}}) ${userQuery}\r\n}`\r\n\r\nconst updateAvatar = async (user_id: string, image_id: string) => {\r\n  let userContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', \r\n    `Bearer ${localStorage.authToken}`,\r\n    updateAvatarQuery,\r\n    {\r\n      \"user_id\": user_id,\r\n      \"image_id\": image_id\r\n    }\r\n  )\r\n  return userContent.data.UserUpsert\r\n}","import { take, call, put, putResolve } from 'redux-saga/effects';\r\n\r\nimport * as actions from './actions'\r\nimport { dataPost } from '../../dataPost'\r\n\r\nexport function* getContactsSaga() {\r\n  while (true) {\r\n    yield take(actions.getContacts.request)\r\n    try {\r\n      const сontacts = yield call(getContactsList)\r\n      yield putResolve(actions.getContacts.success(сontacts))\r\n    } catch (error) {\r\n      yield put(actions.getContacts.failure(error.message))\r\n    }\r\n  }\r\n}\r\n\r\nconst getContactsListQuery = `query users {\r\n  UserFind(query:\"[{}]\"){\r\n    _id\r\n    login\r\n    nick\r\n    createdAt\r\n    avatar{\r\n      _id, url\r\n    }\r\n  }\r\n}`\r\n\r\nconst getContactsList = async () => {\r\n  let сontactsContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', \r\n    `Bearer ${localStorage.authToken}`,\r\n    getContactsListQuery\r\n  )\r\n  return сontactsContent.data.UserFind\r\n}","import { take, call, put, putResolve, select } from 'redux-saga/effects';\r\nimport { push } from 'connected-react-router';\r\n\r\nimport * as actions from './actions'\r\nimport { dataPost } from '../../dataPost'\r\nimport { ChatData } from '../chat/types';\r\nimport { UserData } from '../user/types';\r\n\r\nexport function* getActiveChatSaga() {\r\n  while (true) {\r\n    const { payload } = yield take(actions.getActiveChat.request)\r\n    try {\r\n      const activeUserId = yield select(state => state.auth.authData.id)\r\n      const activeChat = yield call(getActiveChat, payload)\r\n      const activeChatId = activeChat._id\r\n      const activeChatName = yield call(getNameOfChat, activeChat, activeUserId)\r\n      yield putResolve(actions.getActiveChat.success({ activeChat, activeChatId, activeChatName }))\r\n    } catch (error) {\r\n      yield put(actions.getActiveChat.failure(error.message))\r\n    }\r\n  }\r\n}\r\n\r\nconst chatQuery = \r\n`{\r\n  _id\r\n  title\r\n  createdAt\r\n  owner {\r\n    _id\r\n    login\r\n    nick\r\n    avatar {\r\n      _id\r\n      url\r\n    }\r\n  }\r\n  avatar {\r\n    _id\r\n    url\r\n  }\r\n  members {\r\n    _id\r\n    login\r\n    nick\r\n    avatar {\r\n      _id\r\n      url\r\n    }\r\n  }\r\n  messages{\r\n    _id\r\n    text\r\n    createdAt \r\n    owner{\r\n      _id\r\n      login\r\n      nick\r\n    }\r\n    media{\r\n      _id\r\n      url\r\n      type\r\n      originalFileName\r\n      text\r\n    }\r\n    replies {\r\n      _id\r\n      text\r\n      owner {\r\n        _id\r\n        login\r\n        nick\r\n      }\r\n      media{\r\n        _id\r\n        text\r\n        url\r\n        type\r\n        originalFileName\r\n      }\r\n    }\r\n    replyTo {\r\n      _id\r\n      text\r\n      owner {\r\n        _id\r\n        login\r\n        nick\r\n      }\r\n      media{\r\n        _id\r\n        text\r\n        url\r\n        type\r\n        originalFileName\r\n      }\r\n    }\r\n    forwarded {\r\n      _id\r\n      text\r\n      owner {\r\n        _id\r\n        login\r\n        nick\r\n      }\r\n      media{\r\n        _id\r\n        text\r\n        url\r\n        type\r\n        originalFileName\r\n      }\r\n    }\r\n    forwardWith {\r\n      _id\r\n      text\r\n      owner {\r\n        _id\r\n        login\r\n        nick\r\n      }\r\n      media{\r\n        _id\r\n        text\r\n        url\r\n        type\r\n        originalFileName\r\n      }\r\n    }\r\n  }\r\n}`\r\n\r\nconst getActiveChatQuery = `query getActiveChat($activeChatQuery: String){\r\n  ChatFindOne(query: $activeChatQuery)\r\n  ${chatQuery}\r\n}`\r\n\r\nconst getActiveChat = async (chatId: string) => {\r\n  const activeChatQuery = `[{\"_id\": \"${chatId}\"}]`\r\n  let chatContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', \r\n    `Bearer ${localStorage.authToken}`,\r\n    getActiveChatQuery,\r\n    {\r\n      \"activeChatQuery\": activeChatQuery\r\n    }\r\n  )\r\n  return chatContent.data.ChatFindOne\r\n}\r\n\r\nconst getNameOfChat = (activeChat: ChatData, activeUserId: string) => {\r\n  if (activeChat.members.length === 1) {\r\n    return \"You\"\r\n  } else if (activeChat.title) {\r\n    let membersNames = activeChat.members.map(member => member.nick || member.login)\r\n    let members = membersNames.join(', ')\r\n    return `${activeChat.title} with ${members}`\r\n  } else {\r\n    let member = activeChat.members.find(member => {\r\n      return member._id !== activeUserId\r\n    })\r\n    return member && (member.nick ? member.nick : member.login)\r\n  }\r\n}\r\n\r\nexport function* addChatSaga() {\r\n  while (true) {\r\n    const { payload } = yield take(actions.addChat.request)\r\n    try {\r\n      const activeUserId = yield select(state => state.auth.authData.id)\r\n      const newChat = yield call(addNewChat, activeUserId,  payload)\r\n      const activeChatId = newChat._id\r\n      yield putResolve(actions.addChat.success({ newChat, activeChatId }))\r\n      const activeChat = yield call(getActiveChat, activeChatId)\r\n      const activeChatName = yield call(getNameOfChat, activeChat, activeUserId)\r\n      yield putResolve(actions.getActiveChat.success({ activeChat, activeChatId, activeChatName }))\r\n    } catch (error) {\r\n      yield put(actions.addChat.failure(error.message))\r\n    }\r\n  }\r\n}\r\n\r\nconst addNewChatQuery = `mutation addChat ($firstMember_id:ID, $secondMember_id:ID) {\r\n  ChatUpsert(chat: {   \r\n\t\tmembers: [\r\n      {_id: $firstMember_id}, {_id: $secondMember_id}\r\n    ]}) ${chatQuery}\r\n}`\r\n\r\nconst addNewChat = async (firstMember_id: string, secondMember_id: string) => {\r\n  let newChatContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', \r\n    `Bearer ${localStorage.authToken}`,\r\n    addNewChatQuery,\r\n    {\r\n      \"firstMember_id\": firstMember_id,\r\n      \"secondMember_id\": secondMember_id\r\n    }\r\n  )\r\n  return newChatContent.data.ChatUpsert\r\n}\r\n\r\nexport function* addGroupSaga() {\r\n  while (true) {\r\n    const { payload } = yield take(actions.addGroup.request)\r\n    try {\r\n      const newChat = yield call(addNewGroup, payload.chatTitle,  payload.members)\r\n      const activeChatId = newChat._id\r\n      yield putResolve(actions.addGroup.success({ newChat, activeChatId }))\r\n      const activeChat = yield call(getActiveChat, activeChatId)\r\n      const activeUserId = yield select(state => state.auth.authData.id)\r\n      const activeChatName = yield call(getNameOfChat, activeChat, activeUserId)\r\n      yield putResolve(actions.getActiveChat.success({ activeChat, activeChatId, activeChatName }))\r\n      yield put(push('/profile'))\r\n    } catch (error) {\r\n      yield put(actions.addGroup.failure(error.message))\r\n    }\r\n  }\r\n}\r\n\r\nconst addNewGroupQuery = `mutation addNewGroup ($chat_title:String, $members:[UserInput]) {\r\n  ChatUpsert(chat: {\r\n    title: $chat_title,\r\n\t\tmembers: $members\r\n  }) ${chatQuery}\r\n}`\r\n\r\nconst addNewGroup = async (chatTitle: string, members: UserData[]) => {\r\n  const membersQuery = members.map(member => {\r\n    return {\"_id\": member._id}\r\n  })\r\n  let newGroupContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', \r\n    `Bearer ${localStorage.authToken}`,\r\n    addNewGroupQuery,\r\n    {\r\n    \t\"chat_title\": chatTitle,\r\n  \t\t\"members\": membersQuery\r\n    }\r\n  )\r\n  return newGroupContent.data.ChatUpsert\r\n}","import { take, call, put, putResolve, select } from 'redux-saga/effects';\r\n\r\nimport * as actions from './actions'\r\nimport { getActiveChat } from '../chat/actions'\r\nimport { dataPost } from '../../dataPost'\r\n\r\nexport function* sendMessageSaga() {\r\n  while (true) {\r\n    const { payload } = yield take(actions.sendMessage.request)\r\n    try {\r\n      const message = payload.mediaId\r\n        ? yield call(sendMessageacWithAtthment, payload.activeChatId, payload.text, payload.mediaId)\r\n        : yield call(sendMessage, payload.activeChatId, payload.text)\r\n      yield putResolve(actions.sendMessage.success(message))\r\n    } catch (error) {\r\n      yield put(actions.sendMessage.failure(error.message))\r\n    }\r\n  }\r\n}\r\n\r\nconst messageQuery = \r\n`{\r\n  _id\r\n  createdAt\r\n  text\r\n  owner {\r\n    _id\r\n    login\r\n    nick\r\n  }\r\n  media{\r\n    _id\r\n    text\r\n    url\r\n    originalFileName\r\n    type\r\n  }\r\n  replies {\r\n    _id\r\n    text\r\n    owner {\r\n      _id\r\n      login\r\n      nick\r\n    }\r\n    media{\r\n      _id\r\n      text\r\n      url\r\n      originalFileName\r\n      type\r\n    }\r\n  }\r\n  replyTo {\r\n    _id\r\n    text\r\n    owner {\r\n      _id\r\n      login\r\n      nick\r\n    }\r\n    media{\r\n      _id\r\n      text\r\n      url\r\n      originalFileName\r\n      type\r\n    }\r\n  }\r\n  forwarded {\r\n    _id\r\n    text\r\n    owner {\r\n      _id\r\n      login\r\n      nick\r\n    }\r\n    media{\r\n      _id\r\n      text\r\n      url\r\n      originalFileName\r\n      type\r\n    }\r\n  }\r\n  forwardWith {\r\n    _id\r\n    text\r\n    owner {\r\n      _id\r\n      login\r\n      nick\r\n    }\r\n    media{\r\n      _id\r\n      text\r\n      url\r\n      originalFileName\r\n      type\r\n    }\r\n  }\r\n}`\r\n\r\nconst sendMessageQuery = `mutation sendMessage ($chat_id:ID, $text:String) {\r\n  MessageUpsert(message: {\r\n      chat: {_id: $chat_id}, \r\n      text: $text\r\n  }) ${messageQuery}\r\n}`\r\n\r\nconst sendMessage = async (chat_id: string, text: string) => {\r\n  let messageContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', \r\n    `Bearer ${localStorage.authToken}`,\r\n    sendMessageQuery,\r\n    {\r\n      \"chat_id\": chat_id,\r\n      \"text\": text\r\n    }\r\n  )\r\n  return messageContent.data.MessageUpsert\r\n}\r\n\r\nconst sendMessageWithAtthmentQuery = `mutation sendMessage ($chat_id:ID, $text:String, $media_id:ID) {\r\n  MessageUpsert(message: {\r\n      chat: {_id: $chat_id}, \r\n      text: $text,\r\n    \tmedia:[{_id: $media_id}]\r\n  }) ${messageQuery}\r\n}`\r\n\r\nconst sendMessageacWithAtthment = async (chat_id: string, text: string, media_id: string) => {\r\n  let messageContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', \r\n    `Bearer ${localStorage.authToken}`,\r\n    sendMessageWithAtthmentQuery,\r\n    {\r\n      \"chat_id\": chat_id,\r\n      \"text\": text,\r\n      \"media_id\": media_id\r\n    }\r\n  )\r\n  return messageContent.data.MessageUpsert\r\n}\r\n\r\n\r\nexport function* onMessageSaga() {\r\n  while (true) {\r\n    const { payload } = yield take(actions.onMessage)\r\n    const activeUserId = yield select(state => state.user.userData._id)\r\n    if (payload.owner._id !== activeUserId) {\r\n      playSound()\r\n    }\r\n    const activeChatId = yield select(state => state.chat.activeChatId)\r\n    if (activeChatId === payload.chat._id) {\r\n      yield put(getActiveChat.request(activeChatId))\r\n    }\r\n  }\r\n}\r\n\r\nconst playSound = () => {\r\n  const audio = new Audio(\"http://commondatastorage.googleapis.com/codeskulptor-demos/pyman_assets/eatedible.ogg\");\r\n  audio.play();\r\n}\r\n\r\nexport function* replyToMessageSaga() {\r\n  while (true) {\r\n    const { payload } = yield take(actions.replyToMessage.request)\r\n    try {\r\n      const message = yield call(replyToMessage, payload.activeChatId, payload.text, payload.originalMessageId)\r\n      yield putResolve(actions.replyToMessage.success(message))\r\n    } catch (error) {\r\n      yield put(actions.replyToMessage.failure(error.message))\r\n    }\r\n  }\r\n}\r\n\r\nconst replyToMessageQuery = `mutation replyToMessage ($message_id:ID, $chat_id:ID, $text:String) {\r\n  MessageUpsert(message: {\r\n    chat: {_id: $chat_id},\r\n    text: $text\r\n    replyTo: {\r\n      _id: $message_id,\r\n    }\r\n  }) ${messageQuery}\r\n}`\r\n\r\n\r\nconst replyToMessage = async (chat_id: string, text: string, originalMessageId: string) => {\r\n  let messageContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', \r\n    `Bearer ${localStorage.authToken}`,\r\n    replyToMessageQuery,\r\n    {\r\n      \"chat_id\": chat_id,\r\n      \"text\": text,\r\n      \"message_id\": originalMessageId\r\n    }\r\n  )\r\n  return messageContent.data.MessageUpsert\r\n}\r\n\r\nexport function* forwardMessageSaga() {\r\n  while (true) {\r\n    const { payload } = yield take(actions.forwardMessage.request)\r\n    try {\r\n      const message = yield call(forwardMessage, payload.activeChatId, payload.text, payload.originalMessageId )\r\n      yield putResolve(actions.forwardMessage.success(message))\r\n    } catch (error) {\r\n      yield put(actions.forwardMessage.failure(error.message))\r\n    }\r\n  }\r\n}\r\n\r\nconst forwardMessageQuery = `mutation forwardedMessage ($chat_id:ID, $message_id:ID, $text:String) {\r\n  MessageUpsert(message: {\r\n    chat: {_id: $chat_id},\r\n    text: $text,\r\n    forwarded: {\r\n    \t_id: $message_id,\r\n    }\r\n  }) ${messageQuery}\r\n}`\r\n\r\n\r\nconst forwardMessage = async (chat_id: string, text: string, originalMessageId: string) => {\r\n  let messageContent = await dataPost('http://chat.fs.a-level.com.ua/graphql', \r\n    `Bearer ${localStorage.authToken}`,\r\n    forwardMessageQuery,\r\n    {\r\n      \"chat_id\": chat_id,\r\n      \"text\": text,\r\n      \"message_id\": originalMessageId\r\n    }\r\n  )\r\n  return messageContent.data.MessageUpsert\r\n}","import { take, call, put, putResolve } from 'redux-saga/effects';\r\n\r\nimport * as actions from './actions'\r\n\r\nexport function* uploadFileSaga() {\r\n  while (true) {\r\n    const { payload } = yield take(actions.uploadFile.request)\r\n    try {\r\n      const fileData = yield call(getFileData, payload)\r\n      yield putResolve(actions.uploadFile.success(fileData))\r\n    } catch (error) {\r\n      yield put(actions.uploadFile.failure(error.message))\r\n    }\r\n  }\r\n}\r\n\r\nlet getFileData = async (form: HTMLFormElement) => {\r\n    try {\r\n        const response = await fetch('http://chat.fs.a-level.com.ua/upload', \r\n                        {\r\n                          method: \"POST\",\r\n                          headers: localStorage.authToken ? { Authorization: 'Bearer ' + localStorage.authToken } : {},\r\n                          body: new FormData(form)\r\n                        }  );\r\n        const result = response.json();\r\n        return response.ok ? result : new Error('Status is not 200')\r\n    } catch (error) {\r\n        return new Error('DataPost failed')\r\n    }\r\n}","import { all, spawn } from \"redux-saga/effects\";\r\nimport { authByCredsSaga, regByCredsSaga, logoutSaga } from \"./auth/sagas\";\r\nimport { getUserSaga, updateAvatarSaga } from \"./user/sagas\";\r\nimport { getContactsSaga } from \"./contacts/sagas\";\r\nimport { getActiveChatSaga } from \"./chat/sagas\";\r\nimport { addChatSaga, addGroupSaga } from \"./chat/sagas\";\r\nimport { sendMessageSaga, onMessageSaga, replyToMessageSaga, forwardMessageSaga } from \"./message/sagas\";\r\nimport { uploadFileSaga } from \"./media/sagas\";\r\n\r\nexport default function* rootSaga() {\r\n  yield all([\r\n    spawn(authByCredsSaga),\r\n    spawn(regByCredsSaga),\r\n    spawn(getUserSaga),\r\n    spawn(getContactsSaga),\r\n    spawn(getActiveChatSaga),\r\n    spawn(sendMessageSaga),\r\n    spawn(addChatSaga),\r\n    spawn(logoutSaga),\r\n    spawn(onMessageSaga),\r\n    spawn(uploadFileSaga),\r\n    spawn(updateAvatarSaga),\r\n    spawn(replyToMessageSaga),\r\n    spawn(forwardMessageSaga),\r\n    spawn(addGroupSaga)\r\n  ]);\r\n}\r\n","import React from \"react\";\r\nimport { bindActionCreators, Dispatch } from \"redux\";\r\nimport { connect } from \"react-redux\";\r\nimport { Link } from \"react-router-dom\"\r\n\r\nimport { IRootAction, IRootState } from \"../../store/rootReducer\";\r\nimport * as authActions from \"../../store/auth/actions\";\r\n\r\nimport style from './style.module.css'\r\n\r\nconst mapStateToProps = (state: IRootState) =>\r\n ({\r\n  authError: state.auth.authData.error\r\n});\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\r\n  bindActionCreators(\r\n    {\r\n      regByCreds: authActions.regByCreds.request\r\n    },\r\n    dispatch\r\n  );\r\n\r\ntype RegistrationProps = ReturnType<typeof mapStateToProps> &\r\n  ReturnType<typeof mapDispatchToProps>\r\n\r\nconst Registration: React.FC<RegistrationProps> = props => {\r\n  const [nick, setNick] = React.useState(\"\");\r\n  const [login, setLogin] = React.useState(\"\");\r\n  const [password, setPassword] = React.useState(\"\");\r\n  const [password2, setPassword2] = React.useState(\"\");\r\n  const [passwordError, setPasswordError] = React.useState(\"\");\r\n  \r\n  const signUpHandler = (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault()\r\n    if (password !== password2) {\r\n      setPasswordError(\"Passwords does not match\")\r\n      return\r\n    }\r\n    props.regByCreds({ nick, login, password })\r\n }\r\n\r\n  return (\r\n    <div className={style.container}>\r\n      <div className={style.card}>\r\n        <div className={style.header}>\r\n          <h2>Create account</h2>\r\n        </div>\r\n        <form action=\"\" onSubmit={signUpHandler} id=\"form\" className={style.form}>\r\n          <div className={style.formControl}>\r\n            <label htmlFor=\"login\">Login</label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"login\"\r\n              required={true}\r\n              value={login}\r\n              onChange={e => setLogin(e.target.value)}\r\n            />\r\n          </div>\r\n          <div className={style.formControl}>\r\n            <label htmlFor=\"nick\">Nick</label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"nick\"\r\n              required={true}\r\n              value={nick}\r\n              onChange={e => setNick(e.target.value)}\r\n            />\r\n          </div>\r\n          <div className={style.formControl}>\r\n            <label htmlFor=\"password\">Password</label>\r\n            <input\r\n              type=\"password\"\r\n              id=\"password\"\r\n              required={true}\r\n              value={password}\r\n              onChange={e => setPassword(e.target.value)}\r\n            />\r\n          </div>\r\n          <div className={style.formControl}>\r\n            <label htmlFor=\"password2\">Password check</label>\r\n            <input\r\n              type=\"password\"\r\n              id=\"password2\"\r\n              required={true}\r\n              value={password2}\r\n              onChange={e => setPassword2(e.target.value)}\r\n            />\r\n            { (passwordError || props.authError) &&\r\n              <small>{passwordError || props.authError}</small>\r\n            }\r\n          </div>\r\n          <button type=\"submit\" className={style.submitBtn}>Sign Up</button>\r\n          <p>Have an account?  <Link to=\"/sign-in\">Sign In</Link></p>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(Registration));","import React from \"react\";\r\nimport { bindActionCreators, Dispatch } from \"redux\";\r\nimport { connect } from \"react-redux\";\r\nimport { Link } from \"react-router-dom\"\r\n\r\nimport { IRootAction, IRootState } from \"../../store/rootReducer\";\r\nimport * as authActions from \"../../store/auth/actions\";\r\n\r\nimport style from './style.module.css'\r\n\r\nconst mapStateToProps = (state: IRootState) =>\r\n ({\r\n  authError: state.auth.authData.error\r\n});\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\r\n  bindActionCreators(\r\n    {\r\n      authByCreds: authActions.authByCreds.request\r\n    },\r\n    dispatch\r\n  );\r\n\r\ntype AuthorizationProps = ReturnType<typeof mapStateToProps> &\r\n  ReturnType<typeof mapDispatchToProps>\r\n\r\nconst Authorization: React.FC<AuthorizationProps> = props => {\r\n  const [login, setLogin] = React.useState(\"\");\r\n  const [password, setPassword] = React.useState(\"\");\r\n\r\n  const signInHandler = (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault()\r\n    props.authByCreds({ login, password })\r\n  }\r\n\r\n  return (\r\n    <div className={style.container}>\r\n      <div className={style.card}>\r\n        <div className={style.header}>\r\n          <h2>Authorization</h2>\r\n        </div>\r\n        <form action=\"\" onSubmit={signInHandler} id=\"form\" className={style.form}>\r\n          <div className={style.formControl}>\r\n            <label htmlFor=\"login\">Login</label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"login\"\r\n              required={true}\r\n              value={login}\r\n              onChange={e => setLogin(e.target.value)}\r\n            />\r\n          </div>\r\n          <div className={style.formControl}>\r\n            <label htmlFor=\"password\">Password</label>\r\n            <input\r\n              type=\"password\"\r\n              id=\"password\"\r\n              required={true}\r\n              value={password}\r\n              onChange={e => setPassword(e.target.value)}\r\n            />\r\n            { props.authError &&\r\n              <small>Wrong login or password</small>\r\n            }\r\n          </div>\r\n          <button type=\"submit\" className={style.submitBtn}>Sign In</button>\r\n          <p>New to Gossip Room? <Link to=\"/registration\">Join now</Link></p>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(Authorization));","import React from \"react\";\n\nimport { MessageData } from '../../store/message/types'\nimport style from \"./style.module.css\"\n\ninterface Props {\n  chat_id?: string,\n  newMessage?: MessageData,\n  activeChatId?: string | null,\n}\n\nconst NewMessageCounter = (props: Props) => {\n  const [counter, setCounter] = React.useState(0)\n\n  let chatIdWithNewMessage = props.newMessage && props.newMessage.chat ? props.newMessage.chat._id : null\n  \n  React.useEffect(() => {\n    if (props.newMessage && chatIdWithNewMessage === props.chat_id && props.chat_id !== props.activeChatId) {\n      setCounter(counter + 1)\n    }\n\n    if (props.chat_id === props.activeChatId) {\n      setCounter(0)\n    }\n  }, [props.newMessage, props.activeChatId])\n\n  return (  \n    <>\n      { counter > 0 && \n        <div className={style.counter}>\n          {counter}\n        </div>\n      }\n    </>\n  );\n};\nexport default React.memo(NewMessageCounter);","import React from \"react\";\n\nimport { MessageData } from '../../store/message/types'\n\nimport NewMessageCounter from \"../NewMessageCounter\"\nimport style from './style.module.css'\n\ninterface Props {\n  name: string | undefined,\n  chat_id?: string,\n  avatarSrc: string,\n  newMessage?: MessageData,\n  activeChatId?: string | null,\n  onClick?: (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => void\n}\n\nconst User = (props: Props) => {\n\n  React.useEffect(() => {\n\t\tconst authToken = localStorage.getItem('authToken')\n\t\tif (!authToken) {\n\t\t\treturn\n\t\t}\n  }, [])\n  \n  return (  \n    <div className={style.user} onClick={props.onClick}>\n      <img src={props.avatarSrc} alt=\"avatar\" className={style.userImg} />\n      <div className={style.userDetails}>\n        <p className={style.useDetailsName}>{props.name}</p>\n      </div >\n      <NewMessageCounter\n        chat_id={props.chat_id}\n        newMessage={props.newMessage}\n        activeChatId={props.activeChatId}\n      />\n    </div>\n  );\n};\nexport default React.memo(User);","import React from \"react\";\r\nimport { bindActionCreators, Dispatch } from \"redux\";\r\nimport { connect } from \"react-redux\";\r\nimport { Link } from \"react-router-dom\"\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\r\n\r\nimport { IRootAction, IRootState } from \"../../store/rootReducer\";\r\nimport * as authActions from \"../../store/auth/actions\";\r\nimport * as mediaActions from \"../../store/media/actions\";\r\nimport * as userActions from \"../../store/user/actions\";\r\n\r\nimport style from './style.module.css'\r\nimport userAvatar from '../../img/user_avatar.png'\r\n\r\nconst mapStateToProps = (state: IRootState) =>\r\n ({\r\n  activeUserId: state.user.userData._id,\r\n  avatar: state.user.userData.avatar ? `http://chat.fs.a-level.com.ua/${state.user.userData.avatar.url}` : userAvatar,\r\n  imageId: state.media.fileData._id,\r\n  imageUrl: `http://chat.fs.a-level.com.ua/${state.media.fileData.url}`\r\n});\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\r\n  bindActionCreators(\r\n    {\r\n      logout: authActions.logout,\r\n      uploadAvatar: mediaActions.uploadFile.request,\r\n      updateAvatar: userActions.updateAvatar.request,\r\n    },\r\n    dispatch\r\n  );\r\n\r\ntype ButtonWithPopupProps = ReturnType<typeof mapStateToProps> &\r\n  ReturnType<typeof mapDispatchToProps>\r\n\r\ninterface State {\r\n  isOpenedPopup: boolean\r\n  isAvatarUpload: boolean\r\n}\r\n\r\nclass ButtonWithPopup extends React.PureComponent<ButtonWithPopupProps> {\r\n\r\n  state = {\r\n    isOpenedPopup: false,\r\n    isAvatarUpload: false\r\n  };\r\n\r\n  myRef = React.createRef<HTMLDivElement>()\r\n  myFormRef = React.createRef<HTMLFormElement>()\r\n\r\n  closePopup = (event: any) => {\r\n    if (this.myRef.current && !(this.myRef.current.contains(event.target))) {\r\n      this.setState({\r\n        isOpenedPopup: false\r\n      })\r\n    }\r\n  };\r\n\r\n  componentDidUpdate(prevProps: {}, prevState: State) {\r\n    if (prevState.isOpenedPopup === this.state.isOpenedPopup) {\r\n      return;\r\n    }\r\n    if (this.state.isOpenedPopup) {\r\n      document.addEventListener(\"click\", this.closePopup);\r\n    } else {\r\n      document.removeEventListener(\"click\", this.closePopup);\r\n    }\r\n  }\r\n\r\n  togglePopup = () => {\r\n    this.setState({\r\n      isOpenedPopup: !this.state.isOpenedPopup\r\n    })\r\n  }\r\n\r\n  uploadAvatar = (form: HTMLFormElement) => {\r\n    this.props.uploadAvatar(form)\r\n\r\n    this.setState({\r\n      isAvatarUpload: true\r\n    })\r\n  }\r\n\r\n  updateAvatar = (user_id: string, image_id: string | null) => {\r\n    this.props.updateAvatar({ user_id, image_id })\r\n    this.setState({\r\n      isOpenedPopup: false\r\n    })\r\n  }\r\n\r\n  logoutHandler = () => {\r\n    this.props.logout()\r\n  }\r\n\r\n  render() {\r\n    const { isOpenedPopup, isAvatarUpload } = this.state;\r\n    return (\r\n      <div className={style.buttonWithPopup}>\r\n        <button onClick={this.togglePopup} className={style.navOpener}>\r\n          <FontAwesomeIcon icon=\"bars\" />\r\n        </button>\r\n        {isOpenedPopup &&\r\n          <div ref={this.myRef} className={style.popup}>\r\n            <div className={style.popupHeader}>\r\n              <img src={this.props.imageId ? this.props.imageUrl : this.props.avatar} />\r\n              <form className={style.uploadForm}\r\n                ref={this.myFormRef}\r\n                method=\"post\"\r\n                action='/upload'\r\n                encType=\"multipart/form-data\"\r\n                id=\"form\"\r\n              >\r\n              <div className={style.uploadBtnWrapper}>\r\n                  <button className={style.changeButton}>\r\n                    Change avatar\r\n                  </button>\r\n                  <input\r\n                    className={style.uploadInput}\r\n                    type=\"file\"\r\n                    name=\"media\"\r\n                    id=\"media\"\r\n                    onChange={() => { if (this.myFormRef.current) this.uploadAvatar(this.myFormRef.current) }}\r\n                  />\r\n                </div>\r\n              </form>\r\n              { isAvatarUpload &&\r\n                <button\r\n                  className={style.okButton}\r\n                  onClick={() => this.updateAvatar(this.props.activeUserId, this.props.imageId)}\r\n                >\r\n                  Ok\r\n                </button>\r\n              }\r\n            </div>\r\n            <nav className={style.navSidebar}>\r\n              <ul className={style.navList}>\r\n                <li\r\n                  className={style.navItem}\r\n                >\r\n                  <Link to=\"/new_group\">\r\n                    <FontAwesomeIcon icon=\"comments\" />\r\n                    New group\r\n                  </Link>\r\n                </li>\r\n                <li \r\n                  className={style.navItem}\r\n                  onClick={() => this.logoutHandler()}\r\n                >\r\n                  <FontAwesomeIcon icon=\"sign-out-alt\" />\r\n                  Exit\r\n                </li>\r\n              </ul>\r\n            </nav>\r\n          </div>\r\n        }\r\n      </div>\r\n    )\r\n  }\r\n}\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ButtonWithPopup);","import React, { useRef, useState } from 'react';\nimport { bindActionCreators, Dispatch } from \"redux\";\nimport { connect } from \"react-redux\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport { IRootAction, IRootState } from \"../../store/rootReducer\";\nimport * as userActions from \"../../store/user/actions\";\nimport * as contactsActions from \"../../store/contacts/actions\";\nimport * as chatActions from \"../../store/chat/actions\";\nimport { UserData } from '../../store/user/types'\nimport { ChatData } from '../../store/chat/types'\n\nimport User from \"../User\";\nimport userAvatar from '../../img/user_avatar.png'\nimport chatAvatar from '../../img/chat_avatar.png'\nimport ButtonWithPopup from '../ButtonWithPopup';\nimport style from './style.module.css'\n\nconst mapStateToProps = (state: IRootState) => ({\n\tactiveUserId: state.user.userData._id,\n\tcontacts: state.contacts.contactsData,\n\tchats: state.user.userData.chats,\n\tactiveChatId: state.chat.chatData._id,\n\tnewMessage: state.message.messageData\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\n\tbindActionCreators(\n\t\t{\n\t\t\tgetContacts: contactsActions.getContacts.request,\n\t\t\tgetUser: userActions.getUser.request,\n\t\t\tgetActiveChat: chatActions.getActiveChat.request,\n\t\t\taddChat: chatActions.addChat.request\n\t\t},\n\t\tdispatch\n\t);\n\ntype SidebarProps = ReturnType<typeof mapStateToProps> &\n\tReturnType<typeof mapDispatchToProps>;\n\ntype SidebarView = \"contacts\" | \"chats\"\n\nconst Sidebar: React.FC<SidebarProps> = props => {\n\n\tconst [sidebarView, setSidebarView] = React.useState<SidebarView>(\"chats\")\n\n\tReact.useEffect(() => {\n\t\tconst authToken = localStorage.getItem('authToken')\n\t\tif (!authToken) {\n\t\t\treturn\n\t\t}\n\t\tprops.getUser()\n\t\t// console.log(\"props.chats,props.chats.length\", props.chats, props.chats.length)\n\t\t// if (props.chats && props.chats.length) {\n\t\t// \tsetSidebarView(\"contacts\")\n\t\t// }\n\t\tprops.getContacts()\n\t}, [])\n\n\tconst getDetailsOfChat = (chat: ChatData) => {\n\t\tlet details\n\t\tif (chat.members.length === 1) {\n\t\t\tdetails = {\n\t\t\t\tname: chat.title || \"You\",\n\t\t\t\tavatar: chat.avatar ? `http://chat.fs.a-level.com.ua/${chat.avatar.url}` : userAvatar\n\t\t\t}\n\t\t} else if (chat.members.length > 2) {\n\t\t\tdetails = {\n\t\t\t\tname: chat.title || \"Group\",\n\t\t\t\tavatar: chat.avatar ? `http://chat.fs.a-level.com.ua/${chat.avatar.url}` : chatAvatar\n\t\t\t}\n\t\t} else {\n\t\t\tlet member = chat.members.find(member => {\n\t\t\t\treturn member._id !== props.activeUserId\n\t\t\t})\n\t\t\tlet nameFromMember = member && (member.nick || member.login)\n\t\t\tlet memberAvatar = member && member.avatar && `http://chat.fs.a-level.com.ua/${member.avatar.url}`\n\t\t\tdetails = {\n\t\t\t\tname: chat.title || nameFromMember,\n\t\t\t\tavatar: chat.avatar ? `http://chat.fs.a-level.com.ua/${chat.avatar.url}` : (memberAvatar || userAvatar)\n\t\t\t}\n\t\t}\n\t\treturn details\n\t}\n\n\tconst checkMemberInChats = (contactId: string) => {\n\t\tlet contactsChats: string[] = []\n\t\tprops.chats.map(chat => {\n\t\t\tif (chat.members.length === 2) {\n\t\t\t\tchat.members.forEach(member => {\n\t\t\t\t\tif (member._id === contactId) {\n\t\t\t\t\t\tcontactsChats.push(chat._id)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t\treturn contactsChats\n\t}\n\n\tconst activeChatHandler = (chatId: string) => {\n\t\tprops.getActiveChat(chatId)\n\t};\n\n\tconst addChatHandler = (contactId: string) => {\n\t\tif (checkMemberInChats(contactId).length) {\n\t\t\tprops.getActiveChat(checkMemberInChats(contactId)[0])\n\t\t} else {\n\t\t\tprops.addChat(contactId)\n\t\t}\n\t};\n\n\tconst renderSidebarContent = () => {\n\t\t\tif (sidebarView === \"chats\") {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t{ props.chats.map(chat => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<User\n\t\t\t\t\t\t\t\tkey={chat._id}\n\t\t\t\t\t\t\t\tchat_id={chat._id}\n\t\t\t\t\t\t\t\tname={getDetailsOfChat(chat).name}\n\t\t\t\t\t\t\t\tavatarSrc={getDetailsOfChat(chat).avatar}\n\t\t\t\t\t\t\t\tnewMessage={props.newMessage}\n\t\t\t\t\t\t\t\tactiveChatId={props.activeChatId}\n\t\t\t\t\t\t\t\tonClick={() => activeChatHandler(chat._id)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)\n\t\t\t\t\t})}\n\t\t\t\t</>\n\t\t\t)\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t{ props.contacts.map((contact: UserData) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<User \n\t\t\t\t\t\t\t\tkey={contact._id}\n\t\t\t\t\t\t\t\tname={contact.nick || contact.login}\n\t\t\t\t\t\t\t\tavatarSrc={contact.avatar ? `http://chat.fs.a-level.com.ua/${contact.avatar.url}` : userAvatar }\n\t\t\t\t\t\t\t\tonClick={() => addChatHandler(contact._id)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)\n\t\t\t\t\t})}\n\t\t\t\t</>\n\t\t\t)\n\t\t}\n\t}\n\n\treturn (\n\t\t<aside className={style.sidebar}>\n\t\t\t<div className={style.buttonBlock}>\n\t\t\t\t<ButtonWithPopup />\n\t\t\t\t{ sidebarView === \"chats\" && \n\t\t\t\t\t<button \n\t\t\t\t\t\tclassName={style.navButton}\n\t\t\t\t\t\ttitle=\"Contacts\"\n\t\t\t\t\t\tonClick={() => setSidebarView(\"contacts\")}\n\t\t\t\t\t>\n\t\t\t\t\t\t<FontAwesomeIcon icon=\"user-friends\" />\n\t\t\t\t\t</button>\n\t\t\t\t}\n\t\t\t\t{ sidebarView === \"contacts\" &&\n\t\t\t\t\t<button \n\t\t\t\t\t\tclassName={style.navButton}\n\t\t\t\t\t\ttitle=\"Chats\"\n\t\t\t\t\t\tonClick={() => setSidebarView(\"chats\")}\n\t\t\t\t\t>\n\t\t\t\t\t\t<FontAwesomeIcon icon=\"comments\" />\n\t\t\t\t\t</button>\n\t\t\t\t}\n\t\t\t</div>\n\t\t\t{renderSidebarContent()}\n\t\t</aside>\n\t)\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(Sidebar));","import React from \"react\";\n\nimport style from './style.module.css'\n\ninterface Props {\n  name: string,\n  avatarSrc: string\n}\n\nconst Empty = (props: Props) => {\n  return (\n    <div className={style.empty}>\n      <h1 className={style.emptyName}>Welcome, {props.name} </h1>\n      <img src={props.avatarSrc} alt={props.name} className={style.avatar} />\n      <p className={style.emptyInfo}>\n        Please select a chat to start messaging\n      </p>\n    </div>\n  );\n};\nexport default React.memo(Empty);","import React from \"react\";\n\nimport style from './style.module.css'\n\ninterface Props {\n\tactiveChatName: string,\n}\n\nconst Header = (props: Props) => {\n\treturn (\n\t\t<header className={style.header}>\n\t\t\t<h1 className={style.headerName}>{props.activeChatName}</h1>\n\t\t\t<button className={style.settingsButton}>...</button>\n\t\t</header>\n\t);\n}\nexport default React.memo(Header);","import React from \"react\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { IconProp } from \"@fortawesome/fontawesome-svg-core\"\n\nimport style from \"./style.module.css\";\n\ninterface Props {\n    url: string,\n    icon: IconProp,\n    text: string\n}\n\nconst AttachmentLink = (props: Props) => {\n    return (\n        <a href={`http://chat.fs.a-level.com.ua/${props.url}`}\n            className={style.attachmentLink}\n        >\n            <FontAwesomeIcon icon={props.icon} size=\"3x\" className={style.fileIcon} />\n            <p>\n                {props.text}\n            </p>\n        </a>\n    );\n};\nexport default React.memo(AttachmentLink);","import React from \"react\";\nimport Iframe from 'react-iframe'\nimport MicrolinkCard from '@microlink/react';\nimport Linkify from 'linkifyjs/react';\nimport getUrls from 'get-urls';\n\nimport { MessageData, ReplyData } from \"../../store/message/types\";\nimport AttachmentLink from \"../AttachmentLink\"\nimport style from\"./style.module.css\";\n\ninterface Props {\n\tmessage: MessageData | ReplyData | null\n}\n  \nconst parseURLs = (text: string) => {\n    const urls = getUrls(text);\n    const parsedUrls = Array.from(urls).map((url, idx: number) => {\n        return (\n            <MicrolinkCard url={url} key={idx}/>\n        )\n    })\n    return (\n        <>\n            {parsedUrls}\n        </>\n    )\n}\n\nconst FormattedMessage = (props: Props) => {\n    let videoArray =  props.message && props.message.text && props.message.text.match(/http(?:s?):\\/\\/(?:www\\.)?youtu(?:be\\.com\\/watch\\?v=|\\.be\\/)([\\w\\-\\_]*)(&(amp;)?‌ [\\w\\?‌ =]*)?/)\n    if (videoArray) {\n      let videoId = videoArray && videoArray[1]\n      return (\n        <>\n          <a href={props.message && props.message.text}>{props.message && props.message.text}</a>\n          <Iframe\n            url={`https://www.youtube.com/embed/${videoId}`}\n            width=\"100%\"\n            frameBorder={0}\n            allow={\"accelerometer\"}\n            allowFullScreen\n            encrypted-media\n            picture-in-picture\n          />\n        </>\n      )\n    } else if (props.message && props.message.media) {\n      return (\n        <div className={style.mediaAttachment}>\n          <p>{props.message.text}</p>\n          {props.message.media.map(attachment => {\n            if (attachment.type === \"image/png\" || attachment.type === \"image/jpeg\") {\n              return (\n                <img\n                  key={attachment._id}\n                  className={style.attachment}\n                  src={`http://chat.fs.a-level.com.ua/${attachment.url}`}\n                  alt=\"Attachment\"\n                />\n              )\n            } else if (attachment.type === \"video/mp4\" || attachment.type === \"video/webm\" || attachment.type === \"video/ogg\") {\n              return (\n                <>\n                  <AttachmentLink\n                    url={attachment.url}\n                    icon={\"file-video\"}\n                    text={attachment.originalFileName}\n                  />\n                  <video\n                    key={attachment._id}\n                    className={style.attachment}\n                    controls>\n                    <source src={`http://chat.fs.a-level.com.ua/${attachment.url}`} type=\"video/mp4\" />\n                    <source src={`http://chat.fs.a-level.com.ua/${attachment.url}`} type=\"video/webm\" />\n                    <source src={`http://chat.fs.a-level.com.ua/${attachment.url}`} type=\"video/ogg\" />\n                    <p>Your browser doesn't support HTML5 video. Download this file for review.</p>\n                  </video>\n                </>\n              )\n            } else if (attachment.type === \"audio/mp3\" || attachment.type === \"audio/ogg\") {\n              return (\n                <>\n                  <AttachmentLink\n                    url={attachment.url}\n                    icon={\"file-audio\"}\n                    text={attachment.originalFileName}\n                  />\n                  <audio\n                    controls\n                    key={attachment._id}\n                    className={style.attachment}\n                  >\n                    <source src={`http://chat.fs.a-level.com.ua/${attachment.url}`} type=\"audio/mp3\" />\n                    <source src={`http://chat.fs.a-level.com.ua/${attachment.url}`} type=\"audio/ogg\" />\n                    <p>Your browser doesn't support HTML5 audio. Download this file for review.</p>\n                  </audio>\n                </>\n              )\n            } else if (attachment.type === \"application/zip\") {\n              return (\n                <AttachmentLink\n                  url={attachment.url}\n                  icon={\"file-archive\"}\n                  text={attachment.originalFileName}\n                />\n              )\n            } else if (attachment.type && (attachment.type.includes(\"application\") || attachment.type.includes(\"text\"))) {\n              return (\n                <AttachmentLink\n                  url={attachment.url}\n                  icon={\"file-alt\"}\n                  text={attachment.originalFileName}\n                />\n              )\n            } else {\n              return (\n                <AttachmentLink\n                  url={attachment.url}\n                  icon={\"file\"}\n                  text={attachment.originalFileName}\n                />\n              )\n            }\n          })}\n        </div>\n      )\n    } else {\n        return (\n            <>\n              <p>{ props.message && props.message.text }</p>\n              { props.message && props.message.text && <Linkify>{parseURLs(props.message.text)}</Linkify> }\n            </>\n        )\n    }\n}\nexport default React.memo(FormattedMessage);","import React from 'react'\nimport { bindActionCreators, Dispatch } from \"redux\";\nimport { connect } from \"react-redux\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport { IRootAction, IRootState } from \"../../store/rootReducer\";\nimport * as chatActions from \"../../store/chat/actions\";\nimport * as messageActions from \"../../store/message/actions\";\nimport { ChatData } from '../../store/chat/types'\n\nimport style from './style.module.css'\nimport User from \"../User\";\nimport userAvatar from '../../img/user_avatar.png'\nimport chatAvatar from '../../img/chat_avatar.png'\n\nconst mapStateToProps = (state: IRootState) => ({\n  chats: state.user.userData.chats,\n  activeUserId: state.user.userData._id,\n  originalMessage: state.message.savedMessage.originalMessage,\n  isForward: state.message.savedMessage.isForward\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\n  bindActionCreators(\n    {\n      getActiveChat: chatActions.getActiveChat.request,\n      forwardMessage: messageActions.forwardMessage.request,\n      saveOriginalMessage: messageActions.saveOriginalMessage,\n    },\n    dispatch\n  );\n\ntype ForwardingBlockProps = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\nconst ForwardingBlock: React.FC<ForwardingBlockProps> = props => {\n\n  const myRef = React.useRef<HTMLDivElement>(null);\n  \n  React.useEffect(() => {\n\t\tif (props.isForward) {\n      document.addEventListener(\"click\", closeForwardBlock);\n    } else {\n      document.removeEventListener(\"click\", closeForwardBlock);\n    }\n  }, [props.isForward])\n  \n  const closeForwardBlock = (event: any) => {\n    if (myRef.current && !(myRef.current.contains(event.target))) {\n      deleteOriginalMessage()\n    }\n  };\n\n  const deleteOriginalMessage = () => {\n    props.saveOriginalMessage({originalMessage: null, isReply: false, isForward: false})\n  }\n\n  const forwardMessage = (chatId: string) => {\n    props.getActiveChat(chatId)\n    if (props.originalMessage){\n      props.forwardMessage({ activeChatId: chatId, originalMessageId: props.originalMessage._id })\n    }\n  }\n\n  const getDetailsOfChat = (chat: ChatData) => {\n\t\tif (chat.members.length === 1) {\n\t\t\tlet details = {\n\t\t\t\tname: \"You\",\n\t\t\t\tavatar: chat.avatar ? `http://chat.fs.a-level.com.ua/${chat.avatar.url}` : userAvatar\n\t\t\t}\n\t\t\treturn details\n\t\t} else if (chat.members.length > 2) {\n\t\t\tlet details = {\n\t\t\t\tname: chat.title || \"Group\",\n\t\t\t\tavatar: chat.avatar ? `http://chat.fs.a-level.com.ua/${chat.avatar.url}` : chatAvatar\n\t\t\t}\n\t\t\treturn details\n\t\t} else {\n\t\t\tlet member = chat.members.find(member => {\n\t\t\t\treturn member._id !== props.activeUserId\n\t\t\t})\n\t\t\tlet memberAvatar = member && member.avatar && `http://chat.fs.a-level.com.ua/${member.avatar.url}`\n      let groupTitleFromMember = member && (member.nick || member.login)\n      let details = {\n\t\t\t\tname: chat.title ? chat.title : groupTitleFromMember,\n\t\t\t\tavatar: chat.avatar ? `http://chat.fs.a-level.com.ua/${chat.avatar.url}` : (memberAvatar || userAvatar)\n\t\t\t}\n\t\t\treturn details\n\t\t}\n  }\n\n  return (\n    <div ref={myRef} className={style.forwardingContainer}>\n      <header className={style.containerHeader}>\n        <h4 className={style.containerTitle}>Choose recipient</h4>\n        <button onClick={() => deleteOriginalMessage()}>\n          <FontAwesomeIcon icon=\"times\" />\n        </button>\n      </header>\n      <div>\n        { props.chats.map(chat => {\n          return (\n            <User\n              key={chat._id}\n              chat_id={chat._id}\n              name={getDetailsOfChat(chat).name}\n              avatarSrc={getDetailsOfChat(chat).avatar}\n              onClick={() => forwardMessage(chat._id)}\n            />\n          )\n        })}\n      </div>\n    </div>\n  )\n}\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(ForwardingBlock));","import React from 'react'\nimport { bindActionCreators, Dispatch } from \"redux\";\nimport { connect } from \"react-redux\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport classnames from 'classnames';\n\nimport { IRootAction, IRootState } from \"../../store/rootReducer\";\nimport * as messageActions from \"../../store/message/actions\";\n\nimport ForwardingBlock from \"../ForwardingBlock\"\nimport style from './style.module.css'\n\nconst mapStateToProps = (state: IRootState) => ({\n  originalMessage: state.message.savedMessage.originalMessage,\n  isForward: state.message.savedMessage.isForward,\n  isReply: state.message.savedMessage.isReply,\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\n  bindActionCreators(\n    {\n      forwardMessage: messageActions.forwardMessage.request,\n      saveOriginalMessage: messageActions.saveOriginalMessage,\n    },\n    dispatch\n  );\n\ntype MessageMenuProps = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\nconst MessageMenu: React.FC<MessageMenuProps> = props => {\n\n  const [isVisibleMenu, setIsVisibleMenu] = React.useState(true);\n\n  const myRef = React.useRef<HTMLDivElement>(null);\n  \n  React.useEffect(() => {\n\t\tif (props.originalMessage) {\n      document.addEventListener(\"click\", closeForwardBlock);\n    } else {\n      document.removeEventListener(\"click\", closeForwardBlock);\n    }\n  }, [props.originalMessage])\n  \n  const closeForwardBlock = (event: any) => {\n    if (myRef.current && !(myRef.current.contains(event.target))) {\n      setIsVisibleMenu(false)\n    }\n  };\n\n  const replyToMessage = () => {\n    props.saveOriginalMessage({originalMessage: props.originalMessage, isReply: true})\n    setIsVisibleMenu(false)\n  }\n\n  const forwardMessage = () => {\n    props.saveOriginalMessage({originalMessage: props.originalMessage, isForward: true})\n  }\n\n  return (\n    <>\n      <div ref={myRef}\n        className={classnames(style.messageMenu, {\n          [style.invisible]: !isVisibleMenu\n        })} \n      >\n        <ul className={style.menuList}>\n          <li \n            className={style.menuItem}\n            onClick = { () => replyToMessage()}\n          >\n            <FontAwesomeIcon icon=\"reply\" />\n            Reply\n          </li>\n          <li \n            className={style.menuItem}\n            onClick = { () => forwardMessage()}\n          >\n            <FontAwesomeIcon icon=\"share\" />\n            Forward message\n          </li>\n        </ul>\n      </div>\n      { props.isForward &&\n        <ForwardingBlock />\n      }\n    </>\n  )\n}\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(MessageMenu));","import React, {useRef} from \"react\";\nimport { bindActionCreators, Dispatch } from \"redux\";\nimport { connect } from \"react-redux\";\nimport classnames from 'classnames';\nimport moment from 'moment';\n\nimport { IRootState, IRootAction } from \"../../store/rootReducer\";\nimport * as messageActions from \"../../store/message/actions\";\nimport { MessageData } from \"../../store/message/types\";\nimport FormattedMessage from \"../FormattedMessage\"\nimport MessageMenu from \"../MessageMenu\"\nimport style from './style.module.css'\n\nconst mapStateToProps = (state: IRootState) => ({\n  activeUserId: state.user.userData._id,\n  nick: state.user.userData.nick,\n  activeChat: state.chat.chatData,\n  activeChatName: state.chat.activeChatName,\n  messages: state.chat.chatData ? state.chat.chatData.messages : [],\n  media: state.message.messageData.media,\n  mediaUrl: state.media.fileData.url,\n  originalMessage: state.message.savedMessage.originalMessage,\n  isForward: state.message.savedMessage.isForward\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\n  bindActionCreators(\n    {\n      saveOriginalMessage: messageActions.saveOriginalMessage,\n    },\n    dispatch\n  );\n\ntype ChatProps = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\nconst Chat: React.FC<ChatProps> = props => {  \n\n  const chatsRef = useRef<HTMLDivElement>(null);\n\n  React.useEffect(() => {\n\t\tscrollToBottom();\n  }, [])\n  \n  React.useEffect(() => {\n\t\tscrollToBottom();\n\t}, [props.messages])\n\n  const scrollToBottom = () => {\n    if (chatsRef.current) {\n      chatsRef.current.scrollTop = chatsRef.current.scrollHeight;\n    }\n  }\n\n  const isUserMsg = (message: MessageData) => {\n    return message.owner._id === props.activeUserId ? true : false\n  }\n\n  const saveOriginalMessage = (message: MessageData) => {\n    props.saveOriginalMessage({originalMessage: message, isReply: false, isForward: false})\n  }\n\n  return (\n    <div className={style.chats} ref={chatsRef}>\n      { props.messages && props.messages.map((message: MessageData) => (\n        <div \n          key={message._id}\n          className={classnames(style.chat, {\n            [style.isUserMsg]: isUserMsg(message)\n          })}\n          onClick = { () => saveOriginalMessage(message) }\n        >\n          { message.replyTo &&\n            <div className={style.replyBlock}>\n              <p className={style.owner}>\n                { message.replyTo.owner.nick || message.replyTo.owner.login }\n              </p>\n                <FormattedMessage message={message.replyTo} />\n            </div>\n          }\n          { message.forwarded &&\n            <div className={style.forwardedBlock}>\n              <p className={style.owner}>\n                Forwarded from { message.forwarded.owner.nick || message.forwarded.owner.login }\n              </p>\n              <FormattedMessage message={message.forwarded} />\n            </div>\n          } \n          { !isUserMsg &&\n            <p className={style.owner}>\n              { message.owner.nick || message.owner.login }\n            </p>\n          }\n          <FormattedMessage message={message} />\n          <time className={style.timeBlock}>\n            {moment(+message.createdAt).format('HH:mm  DD.MM')}\n          </time>\n        </div>\n      ))}\n      { props.originalMessage && \n        <MessageMenu />\n      }\n    </div>\n  );\n}\nexport default connect(mapStateToProps, mapDispatchToProps)(Chat);","import React from 'react'\nimport 'emoji-mart/css/emoji-mart.css'\nimport { Picker } from 'emoji-mart'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport style from './style.module.css'\n\ninterface Props {\n  addEmoji: any\n}\n\ninterface State {\n  isOpenedEmoji: boolean,\n  emojiObj: string\n}\n\nclass ButtonWithEmoji extends React.PureComponent<Props, State> {\n  constructor(props: never) {\n    super(props);\n    this.state = {\n      isOpenedEmoji: false,\n      emojiObj: \"\"\n    }\n  }\n\n  myRef = React.createRef<HTMLDivElement>()\n\n  closeEmoji = (event: any) => {\n    if (this.myRef.current && !(this.myRef.current.contains(event.target))) {\n      this.setState({\n        isOpenedEmoji: false\n      })\n    }\n  };\n\n  componentDidUpdate(prevProps: {}, prevState: State) {\n    if (prevState.isOpenedEmoji === this.state.isOpenedEmoji) {\n      return;\n    }\n    if (this.state.isOpenedEmoji) {\n      document.addEventListener(\"click\", this.closeEmoji);\n    } else {\n      document.removeEventListener(\"click\", this.closeEmoji);\n    }\n  }\n\n  toggleEmoji = () => {\n    this.setState({\n      isOpenedEmoji: !this.state.isOpenedEmoji\n    })\n  }\n\n  render() {\n    const { isOpenedEmoji } = this.state;\n    return (\n      <div className={style.buttonWithEmoji}>\n        <button onClick={ this.toggleEmoji } className={style.button}>\n          <FontAwesomeIcon icon=\"smile\" />\n        </button>\n        { isOpenedEmoji && \n          <div ref={this.myRef} className={style.emojiBlock}>\n            <Picker set='google' onSelect={emoji => {this.props.addEmoji(emoji)}} />\n          </div>\n        }\n      </div>\n    )\n  }\n}\nexport default ButtonWithEmoji;\n","import React from 'react'\nimport { bindActionCreators, Dispatch } from \"redux\";\nimport { connect } from \"react-redux\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport { IRootAction, IRootState } from \"../../store/rootReducer\";\nimport * as messageActions from \"../../store/message/actions\";\nimport * as mediaActions from \"../../store/media/actions\";\n\nimport style from './style.module.css'\n\nconst mapStateToProps = (state: IRootState) => ({\n  activeChatId: state.chat.activeChatId,\n  fileId: state.media.fileData._id\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\n  bindActionCreators(\n    {\n      uploadFile: mediaActions.uploadFile.request,\n      sendMessage: messageActions.sendMessage.request\n    },\n    dispatch\n  );\n\ntype ButtonWithFileUploadProps = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\ninterface State {\n  isOpenedFileUpload: boolean,\n  fileMessage: string\n}\n\nclass ButtonWithFileUpload extends React.PureComponent<ButtonWithFileUploadProps> {\n  state = {\n    isOpenedFileUpload: false,\n    fileMessage: \"\"\n  }\n\n  myRef = React.createRef<HTMLDivElement>()\n  myFormRef = React.createRef<HTMLFormElement>()\n  fileAttachmentRef = React.createRef<HTMLInputElement>();\n\n  closeFileUpload = (event: any) => {\n    if (this.myRef.current && !(this.myRef.current.contains(event.target))) {\n      this.setState({\n        isOpenedFileUpload: false\n      })\n    }\n  };\n\n  componentDidUpdate(prevProps: {}, prevState: State) {\n    if (prevState.isOpenedFileUpload === this.state.isOpenedFileUpload) {\n      return;\n    }\n    if (this.state.isOpenedFileUpload) {\n      document.addEventListener(\"click\", this.closeFileUpload);\n    } else {\n      document.removeEventListener(\"click\", this.closeFileUpload);\n    }\n  }\n\n  toggleFileUpload = () => {\n    this.setState({\n      isOpenedFileUpload: !this.state.isOpenedFileUpload\n    })\n  }\n\n  uploadFile = (form: HTMLFormElement) => {\n    this.props.uploadFile(form)\n  }\n\n  sendAttachment = (e: React.FormEvent<HTMLFormElement>) => {\n    const { fileMessage } = this.state;\n\n    if (this.props.activeChatId) {\n      this.props.sendMessage({\n        activeChatId: this.props.activeChatId,\n        text: fileMessage,\n        mediaId: this.props.fileId\n      })      \n    }\n\n    this.setState({\n      isOpenedFileUpload: false,\n      fileMessage: '',\n    });\n  }\n\n  render() {\n    const { isOpenedFileUpload, fileMessage } = this.state;\n    return (\n      <div className={style.buttonWithFileUpload}>\n        <button onClick={this.toggleFileUpload} className={style.paperclipButton} >\n          <FontAwesomeIcon icon=\"paperclip\" />\n        </button>\n        { isOpenedFileUpload &&\n          <div ref={this.myRef} className={style.dialogContainer}>\n            <header className={style.dialogHeader}>\n              <h4>Upload a file</h4>\n              <button onClick={() => this.setState({ isOpenedFileUpload: false })}>\n                <FontAwesomeIcon icon=\"times\" />\n              </button>\n            </header>\n            <form\n              className={style.dialogForm}\n              ref={this.myFormRef}\n              method=\"post\"\n              action='/upload'\n              encType=\"multipart/form-data\"\n              id=\"form\"\n              onSubmit={this.sendAttachment}\n            >            \n              <input\n                type=\"file\"\n                name=\"media\"\n                id=\"media\"\n                ref={this.fileAttachmentRef}\n                onChange={() => { if (this.myFormRef.current) this.uploadFile(this.myFormRef.current) }}\n              />\n              <label className={style.dialogLabel} htmlFor=\"fileMessage\">\n                Add a message about the file\n              </label>\n              <input\n                id=\"fileMessage\"\n                className={style.dialogInput}\n                autoFocus\n                type=\"text\"\n                name=\"fileMessage\"\n                value={fileMessage}\n                onChange={(e) => this.setState({ fileMessage: e.target.value })}\n                placeholder=\"Write your message\"\n              />\n              <button type=\"submit\" className={style.submitBtn}>\n                Upload\n            </button>\n            </form>\n          </div>\n        }\n      </div>\n    )\n  }\n}\nexport default connect(mapStateToProps, mapDispatchToProps)(ButtonWithFileUpload);\n\n\n\n// const ButtonWithFileUpload: React.FC<ButtonWithFileUploadProps> = props => {\n\n//   const [isOpenedFileUpload, setIsOpenedFileUpload] = React.useState(false);\n//   const [fileMessage, setFileMessage] = React.useState(\"\");\n\n//   const myRef = React.useRef<HTMLDivElement>(null);\n//   const myFormRef = React.useRef<HTMLFormElement>(null);\n//   const fileAttachmentRef = React.useRef<HTMLInputElement>(null);\n  \n//   React.useEffect(() => {\n// \t\tif (isOpenedFileUpload) {\n//       document.addEventListener(\"click\", closeFileUpload);\n//     } else {\n//       document.removeEventListener(\"click\", closeFileUpload);\n//     }\n// \t}, [isOpenedFileUpload])\n\n//   const closeFileUpload = (event: any) => {\n//     if (myRef.current && !(myRef.current.contains(event.target))) {\n//       setIsOpenedFileUpload(false)\n//     }\n//   };\n\n//   const toggleFileUpload = () => {\n//     setIsOpenedFileUpload(!isOpenedFileUpload)\n//   }\n\n//   const uploadFile = (form: HTMLFormElement) => {\n//     props.uploadFile(form)\n//   }\n\n//   const sendAttachment = (e: React.FormEvent<HTMLFormElement>) => {\n//     if (props.activeChatId) {\n//       props.sendMessage({\n//         activeChatId: props.activeChatId,\n//         text: fileMessage,\n//         mediaId: props.fileId\n//       })      \n//     }\n//     setIsOpenedFileUpload(false)\n//     setFileMessage(\"\")\n//   }\n\n//     // const { isOpenedFileUpload, fileMessage } = this.state;\n//   return (\n//     <div className={style.buttonWithFileUpload}>\n//       <button onClick={toggleFileUpload} className={style.paperclipButton} >\n//         <FontAwesomeIcon icon=\"paperclip\" />\n//       </button>\n//       { isOpenedFileUpload &&\n//         <div ref={myRef} className={style.dialogContainer}>\n//           <header className={style.dialogHeader}>\n//             <h4>Upload a file</h4>\n//             <button onClick={() => setIsOpenedFileUpload(false)}>\n//               <FontAwesomeIcon icon=\"times\" />\n//             </button>\n//           </header>\n//           <form\n//             className={style.dialogForm}\n//             ref={myFormRef}\n//             method=\"post\"\n//             action='/upload'\n//             encType=\"multipart/form-data\"\n//             id=\"form\"\n//             onSubmit={sendAttachment}\n//           >            \n//             <input\n//               type=\"file\"\n//               name=\"media\"\n//               id=\"media\"\n//               ref={fileAttachmentRef}\n//               onChange={() => { if (myFormRef.current) uploadFile(myFormRef.current) }}\n//             />\n//             <label className={style.dialogLabel} htmlFor=\"new-message\">\n//               Add a message about the file\n//           </label>\n//             <input\n//               id=\"new-message\"\n//               className={style.dialogInput}\n//               autoFocus\n//               type=\"text\"\n//               name=\"fileMessage\"\n//               value={fileMessage}\n//               onChange={(e) => setFileMessage(e.target.value)}\n//               placeholder=\"Write your message\"\n//             />\n//             <button type=\"submit\" className={style.submitBtn}>\n//               Upload\n//           </button>\n//           </form>\n//         </div>\n//       }\n//     </div>\n//   )\n// }\n// export default connect(mapStateToProps, mapDispatchToProps)(ButtonWithFileUpload);\n","import React from \"react\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport { MessageData } from \"../../store/message/types\";\nimport FormattedMessage from \"../FormattedMessage\"\nimport style from\"./style.module.css\";\n\ninterface Props {\n    originalMessage: MessageData | null,\n    deleteOriginalMessage: any\n}\n\nconst OriginalMessageBlock = (props: Props) => {\n    return (\n        <div className={style.originalMessageBlock}>\n            <div className={style.originalMessage}>\n                <p className={style.owner}>\n                    { props.originalMessage && (props.originalMessage.owner.nick || props.originalMessage.owner.login) }\n                </p>\n                <FormattedMessage message={props.originalMessage} />\n                <button \n                    onClick = {() => props.deleteOriginalMessage()}\n                    className={style.deleteOriginalMessage}\n                >\n                    <FontAwesomeIcon icon=\"times\" />\n                </button>\n            </div>\n        </div>\n\t);\n}\nexport default React.memo(OriginalMessageBlock);","import React from \"react\";\nimport { bindActionCreators, Dispatch } from \"redux\";\nimport { connect } from \"react-redux\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport { IRootAction, IRootState } from \"../../store/rootReducer\";\nimport * as messageActions from \"../../store/message/actions\";\n\nimport ButtonWithEmoji from \"../ButtonWithEmoji\"\nimport ButtonWithFileUpload from \"../ButtonWithFileUpload\"\nimport OriginalMessageBlock from \"../OriginalMessageBlock\"\nimport style from './style.module.css'\n\nconst mapStateToProps = (state: IRootState) => ({\n  activeChatId: state.chat.activeChatId,\n  originalMessage: state.message.savedMessage.originalMessage,\n  isReply: state.message.savedMessage.isReply,\n  isForward: state.message.savedMessage.isForward\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\n  bindActionCreators(\n    {\n      sendMessage: messageActions.sendMessage.request,\n      replyToMessage: messageActions.replyToMessage.request,\n      forwardMessage: messageActions.forwardMessage.request,\n      saveOriginalMessage: messageActions.saveOriginalMessage,\n    },\n    dispatch\n  );\n\ntype MessageInputProps = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\nconst MessageInput: React.FC<MessageInputProps> = (props) => {\n  const [text, setText] = React.useState(\"\");\n\n  const deleteOriginalMessage = () => {\n    props.saveOriginalMessage({originalMessage: null, isReply: false, isForward: false})\n  }\n\n  const addEmoji = (emoji: any) => {\n    setText(text + emoji.native)\n  }\n\n  const sendMessageHandler = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault()\n    if (text.trim() === '') return;\n    if (props.activeChatId && props.originalMessage && props.isReply) {\n      props.replyToMessage({ activeChatId: props.activeChatId, text, originalMessageId: props.originalMessage._id })\n    } else if (props.activeChatId) {\n      props.sendMessage({ activeChatId: props.activeChatId, text, mediaId: null })\n    }\n    setText(\"\")\n  }\n\n  return (\n    <>\n      { props.isReply &&\n        <OriginalMessageBlock \n          originalMessage={props.originalMessage}\n          deleteOriginalMessage={deleteOriginalMessage}\n        />\n      }\n      <div className={style.messageBlock}>\n        <ButtonWithEmoji addEmoji={addEmoji} />\n        <form action=\"\" onSubmit={sendMessageHandler} className={style.messageForm}>\n          <input\n            className={style.messageInput}\n            placeholder=\"Write your message\"\n            type=\"text\"\n            autoFocus={true}\n            value={text}\n            onChange={e => setText(e.target.value)}\n          />\n          <div className={style.buttonBlock}>\n            <button type=\"submit\" className={style.button} >\n              <FontAwesomeIcon icon=\"paper-plane\" />\n            </button>\n            <ButtonWithFileUpload />\n          </div>\n        </form>\n      </div>\n    </>\n  );\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(MessageInput));","import React from \"react\";\nimport Header from \"../Header\";\n\nimport Chat from \"../Chat\";\nimport MessageInput from \"../MessageInput\";\nimport style from './style.module.css'\n\ninterface Props {\n  name: string,\n}\n\nconst ChatWindow = (props: Props) => {\n  return (\n    <div className={style.chatWindow}>\n      <Header activeChatName = {props.name} />\n      <Chat />\n      <MessageInput />\n    </div>\n  );\n};\n\nexport default React.memo(ChatWindow);","import React from 'react';\nimport { bindActionCreators, Dispatch } from \"redux\";\nimport { connect } from \"react-redux\";\n\nimport { IRootAction, IRootState } from \"../../store/rootReducer\";\nimport * as userActions from \"../../store/user/actions\";\n\nimport style from './style.module.css'\nimport Empty from \"../Empty\";\nimport ChatWindow from \"../ChatWindow\";\nimport userAvatar from '../../img/user_avatar.png'\n\nconst mapStateToProps = (state: IRootState) => ({\n  nick: state.user.userData.nick,\n  login: state.user.userData.login,\n  avatar: state.user.userData.avatar ? `http://chat.fs.a-level.com.ua/${state.user.userData.avatar.url}` : userAvatar,\n  activeChatId: state.chat.chatData._id,\n  activeChatName: state.chat.activeChatName\n});\n\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\n  bindActionCreators(\n    {\n      getUser: userActions.getUser.request,\n    },\n    dispatch\n  );\n\ntype MainProps = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\nconst Main: React.FC<MainProps> = props => {\n\n  const renderMainPageContent = () => {\n    if (!props.activeChatId) {\n      return (\n        <Empty \n          name={props.nick || props.login}\n          avatarSrc={props.avatar} \n        />\n      )\n    }  else {\n      return (\n        <ChatWindow name={props.activeChatName} />\n      )\n    }\n  }\n\n  return (\n    <main className={style.main}>\n      {renderMainPageContent()}\n    </main>\n  )\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(Main));\n","import React from \"react\";\r\nimport { bindActionCreators, Dispatch } from \"redux\";\r\nimport { connect } from \"react-redux\";\r\nimport io from 'socket.io-client';\r\n\r\nimport { IRootAction } from \"../../store/rootReducer\";\r\nimport * as userActions from \"../../store/user/actions\";\r\nimport * as messageActions from \"../../store/message/actions\";\r\nimport { MessageData } from '../../store/message/types'\r\nimport { DecodedToken } from '../../store/auth/types'\r\n\r\nimport style from './style.module.css'\r\nimport Sidebar from '../Sidebar';\r\nimport Main from \"../Main\";\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\r\n  bindActionCreators(\r\n    {\r\n      getUser: userActions.getUser.request,\r\n      onMessage: messageActions.onMessage,\r\n    },\r\n    dispatch\r\n  );\r\n\r\ntype ProfileProps = ReturnType<typeof mapDispatchToProps>;\r\n\r\nconst Profile: React.FC<ProfileProps> = props => {\r\n\r\n  React.useEffect(() => {\r\n    const authToken = localStorage.getItem('authToken')\r\n    if (!authToken) {\r\n      return\r\n    }\r\n    // props.getUser()\r\n\r\n\r\n    const socket = io('http://chat.fs.a-level.com.ua/');\r\n    socket.emit('jwt', localStorage.authToken)\r\n    socket.on('jwt_ok', (data: DecodedToken) => console.log(data))\r\n    socket.on('jwt_fail', (error: string) => console.log(error))\r\n    socket.on('msg', (message: MessageData) => {\r\n      props.onMessage(message)\r\n    })\r\n  },[])\r\n\r\n  return (\r\n    <div className={style.profile}>\r\n      <Sidebar />\r\n      <Main />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default connect( null, mapDispatchToProps)(React.memo(Profile));\r\n","import React from \"react\";\r\nimport { bindActionCreators, Dispatch } from \"redux\";\r\nimport { connect } from \"react-redux\";\r\nimport { Link } from \"react-router-dom\"\r\n\r\nimport { IRootAction, IRootState } from \"../../store/rootReducer\";\r\nimport * as chatActions from \"../../store/chat/actions\";\r\nimport { UserData } from '../../store/user/types'\r\n\r\nimport style from './style.module.css'\r\nimport User from \"../User\";\r\nimport userAvatar from '../../img/user_avatar.png'\r\n\r\nconst mapStateToProps = (state: IRootState) =>\r\n ({\r\n  activeUser: state.user.userData,\r\n  contacts: state.contacts.contactsData,\r\n  chatAvatar: state.chat.chatData.avatar ? `http://chat.fs.a-level.com.ua/${state.chat.chatData.avatar.url}` : userAvatar,\r\n  imageId: state.media.fileData._id,\r\n  imageUrl: `http://chat.fs.a-level.com.ua/${state.media.fileData.url}`\r\n});\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch<IRootAction>) =>\r\n  bindActionCreators(\r\n    {\r\n      getActiveChat: chatActions.getActiveChat.request,\r\n      addGroup: chatActions.addGroup.request\r\n    },\r\n    dispatch\r\n  );\r\n\r\ntype CreationNewChatProps = ReturnType<typeof mapStateToProps> &\r\n  ReturnType<typeof mapDispatchToProps>\r\n\r\nconst CreationNewChat: React.FC<CreationNewChatProps> = props => {\r\n  let defaultMembers = [props.activeUser]\r\n\r\n  const [chatTitle, setChatTitle] = React.useState(\"\");\r\n  const [members, setMembers] = React.useState(defaultMembers);\r\n\r\n  const myFormRef = React.useRef<HTMLFormElement>(null)\r\n\r\n  const addMemberHandler = (contact: UserData) => {\r\n    if (!members.includes(contact)) {\r\n      setMembers([...members, contact])\r\n    }\r\n  }\r\n\r\n  const addGroupHandler = () => {\r\n    props.addGroup({ chatTitle, members })\r\n  }\r\n\r\n  return (\r\n    <div className={style.container}>\r\n      <div className={style.card}>\r\n        <div className={style.header}>\r\n          <h2>Create New Chat</h2>\r\n        </div>\r\n        <div className={style.main}> \r\n          <form className={style.form}\r\n            ref={myFormRef}\r\n            method=\"post\"\r\n            action='/upload'\r\n            encType=\"multipart/form-data\"\r\n            id=\"form\"\r\n          >\r\n            <label htmlFor=\"title\">Group name</label>\r\n            <input\r\n              className={style.titleInput}\r\n              type=\"text\"\r\n              id=\"title\"\r\n              value={chatTitle}\r\n              onChange={(e) => setChatTitle(e.target.value)}\r\n            />\r\n          </form>\r\n          <h4>Add members</h4>\r\n          <div className={style.users}>\r\n            <div className={style.contacts}>\r\n              { props.contacts.map((contact: UserData) => {\r\n                return (\r\n                  <User \r\n                    key={contact._id}\r\n                    name={contact.nick || contact.login}\r\n                    avatarSrc={contact.avatar ? `http://chat.fs.a-level.com.ua/${contact.avatar.url}` : userAvatar }\r\n                    onClick={() => addMemberHandler(contact)}\r\n                  />\r\n                )\r\n              })}\r\n            </div>\r\n            <div className={style.members}>\r\n              { members.map((member: UserData) => {\r\n                return (\r\n                  <User \r\n                    key={member._id}\r\n                    name={member.nick || member.login}\r\n                    avatarSrc={member.avatar ? `http://chat.fs.a-level.com.ua/${member.avatar.url}` : userAvatar }\r\n                  />\r\n                )\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className={style.buttonBlock}>\r\n          <button onClick={addGroupHandler}>\r\n            Create\r\n          </button>\r\n          <button>\r\n            <Link to=\"/profile\">Cancel</Link>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(CreationNewChat));","import React from 'react';\r\nimport { Switch, Route, Redirect } from 'react-router-dom';\r\nimport { connect } from 'react-redux';\r\n\r\nimport { IRootState } from './store/rootReducer';\r\nimport Registration from './components/Registration';\r\nimport Authorization from './components/Authorization';\r\nimport Profile from './components/Profile';\r\nimport CreationNewChat from './components/CreationNewChat';\r\n\r\nconst mapStateToProps = (state: IRootState) => ({\r\n    authToken: state.auth.authData.authToken\r\n})\r\n\r\ntype RoutesProps = ReturnType<typeof mapStateToProps>\r\n\r\nconst Routes: React.FC<RoutesProps> = ({ authToken }) => (\r\n    <Switch>\r\n        <Route exact path=\"/sign-in\" component={Authorization} />\r\n        <Route exact path=\"/registration\" component={Registration} />\r\n        {!authToken && <Redirect from=\"/\" to=\"/sign-in\" />}\r\n        <Route exact path=\"/profile\" component={Profile} />\r\n        <Route exact path=\"/new_group\" component={CreationNewChat} />\r\n        {authToken && <Redirect from=\"/\" to=\"/profile\" />}\r\n        <Route path=\"/\" render={() => <p>Page Not Found</p>} />\r\n    </Switch>\r\n)\r\nexport default connect(mapStateToProps)(React.memo(Routes))","import React from 'react';\nimport { createStore, applyMiddleware } from 'redux'\nimport { Provider } from 'react-redux'\nimport createSagaMiddleware from 'redux-saga'\nimport { ConnectedRouter, routerMiddleware } from 'connected-react-router'\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport { faSmile,\n         faPaperclip,\n         faPaperPlane,\n         faBars,\n         faUserFriends,\n         faComments,\n         faSignOutAlt,\n         faFileAlt,\n         faFileArchive,\n         faFile,\n         faFileVideo,\n         faFileAudio,\n         faTimes,\n         faCheckCircle,\n         faExclamationCircle,\n         faReply,\n         faShare\n       } from '@fortawesome/free-solid-svg-icons'\n\nimport rootReducer from './store/rootReducer';\nimport rootSaga from './store/rootSaga';\nimport { history } from './history';\nimport Routes from './Routes';\n\nlibrary.add(faSmile,\n            faPaperclip,\n            faPaperPlane,\n            faBars,\n            faUserFriends,\n            faComments,\n            faSignOutAlt,\n            faFileAlt,\n            faFileArchive, \n            faFile,\n            faFileVideo,\n            faFileAudio,\n            faTimes,\n            faCheckCircle,\n            faExclamationCircle,\n            faReply,\n            faShare\n          )\n\nconst sagaMiddleware = createSagaMiddleware()\n\nexport const store = createStore(rootReducer, applyMiddleware(\n  routerMiddleware(history),\n  sagaMiddleware,\n))\n\nsagaMiddleware.run(rootSaga)\n\nfunction App() {\n  return (\n    <Provider store={store}>\n      <ConnectedRouter history={history}>\n        <Routes />\n      </ConnectedRouter>\n    </Provider>\n  )\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","module.exports = __webpack_public_path__ + \"static/media/user_avatar.c3631c65.png\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"buttonWithPopup\":\"style_buttonWithPopup__1lQAQ\",\"navOpener\":\"style_navOpener__3Hw_I\",\"popup\":\"style_popup__u9k-3\",\"popupHeader\":\"style_popupHeader__2ZHlh\",\"uploadForm\":\"style_uploadForm__jtt_q\",\"uploadBtnWrapper\":\"style_uploadBtnWrapper__WEYDC\",\"uploadInput\":\"style_uploadInput__3lZr2\",\"changeButton\":\"style_changeButton__HqBnn\",\"okButton\":\"style_okButton__1yZD1\",\"navSidebar\":\"style_navSidebar__3o8Bs\",\"navList\":\"style_navList__1QP6Z\",\"navItem\":\"style_navItem__1zHpi\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"style_container__xzI97\",\"card\":\"style_card__2GpAs\",\"header\":\"style_header__2fbvp\",\"main\":\"style_main__2Q6_f\",\"form\":\"style_form__3OwfY\",\"buttonBlock\":\"style_buttonBlock__29ddq\",\"users\":\"style_users__-mXZN\",\"contacts\":\"style_contacts__10WPO\",\"members\":\"style_members__3Fwuh\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"style_container__33Xe_\",\"card\":\"style_card__2EFo9\",\"header\":\"style_header__3R0wg\",\"form\":\"style_form__bCUWs\",\"formControl\":\"style_formControl__271Bu\",\"submitBtn\":\"style_submitBtn__2F-G9\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"chats\":\"style_chats__jiJor\",\"chat\":\"style_chat__15hmj\",\"isUserMsg\":\"style_isUserMsg__23Qao\",\"replyBlock\":\"style_replyBlock__17Q2S\",\"owner\":\"style_owner__bGB4C\",\"timeBlock\":\"style_timeBlock__3B-5_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"paperclipButton\":\"style_paperclipButton__HjiF1\",\"dialogContainer\":\"style_dialogContainer__HF7Tf\",\"dialogHeader\":\"style_dialogHeader__OE5dX\",\"dialogForm\":\"style_dialogForm__3EKHg\",\"dialogLabel\":\"style_dialogLabel__3UVsc\",\"dialogInput\":\"style_dialogInput__bH3wN\",\"submitBtn\":\"style_submitBtn__3REnT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"style_container__390OS\",\"card\":\"style_card__2MJRR\",\"header\":\"style_header__1jo4u\",\"form\":\"style_form__2p8YJ\",\"formControl\":\"style_formControl__qwFzM\",\"submitBtn\":\"style_submitBtn__13gEm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"messageMenu\":\"style_messageMenu__pJRDf\",\"invisible\":\"style_invisible__1LjwZ\",\"menuList\":\"style_menuList__AcjpA\",\"menuItem\":\"style_menuItem__8d5iJ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"messageBlock\":\"style_messageBlock__3YrA3\",\"messageForm\":\"style_messageForm__3Mcuz\",\"messageInput\":\"style_messageInput__2lCn9\",\"button\":\"style_button__3Jpgk\",\"ButtonWithEmoji\":\"style_ButtonWithEmoji__2Pk_-\",\"buttonBlock\":\"style_buttonBlock__g4UAK\",\"uploadBtnWrapper\":\"style_uploadBtnWrapper__bhQkQ\",\"uploadInput\":\"style_uploadInput__2F-YU\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"user\":\"style_user__2v5VR\",\"userImg\":\"style_userImg__1CkCR\",\"userDetails\":\"style_userDetails__wkzC-\",\"userDetailsName\":\"style_userDetailsName__2_mEK\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"sidebar\":\"style_sidebar__3J9v9\",\"buttonBlock\":\"style_buttonBlock__3eLO2\",\"navButton\":\"style_navButton__2lPuw\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"empty\":\"style_empty__1X47t\",\"emptyName\":\"style_emptyName__2XU3c\",\"emptyInfo\":\"style_emptyInfo__R38MY\",\"avatar\":\"style_avatar__UQFNR\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"mediaAttachment\":\"style_mediaAttachment__3QnPn\",\"attachment\":\"style_attachment__1OkB3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"originalMessageBlock\":\"style_originalMessageBlock__2t3vV\",\"originalMessage\":\"style_originalMessage__200am\",\"owner\":\"style_owner__29svV\",\"deleteOriginalMessage\":\"style_deleteOriginalMessage__3eBEB\"};","module.exports = \"data:image/png;base64,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\"","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"style_header__MlSQ_\",\"headerName\":\"style_headerName__qUa0b\",\"settingsButton\":\"style_settingsButton__29FvD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"forwardingContainer\":\"style_forwardingContainer__5s0m0\",\"containerHeader\":\"style_containerHeader__1xJtM\",\"containerTitle\":\"style_containerTitle__3_Ko8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"buttonWithEmoji\":\"style_buttonWithEmoji__1MOip\",\"emojiBlock\":\"style_emojiBlock__3BsgC\",\"button\":\"style_button__3YROV\"};"],"sourceRoot":""}