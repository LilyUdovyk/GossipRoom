(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{136:function(e,t){},139:function(e,t,a){},140:function(e,t,a){},141:function(e,t,a){},142:function(e,t,a){},143:function(e,t,a){},144:function(e,t,a){},145:function(e,t,a){},147:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(50),o=a.n(c),s=(a(98),a(10)),u=a(11),i=a(92),l=a(85),d=a(39),m=a(42),p=a(27),g=a(21),h=Object(g.a)(),v=a(9),f=a(6),b=Object(f.createAsyncAction)("auth/AUTH_BY_CREDS_REQUEST","auth/AUTH_BY_CREDS_SUCCESS","auth/AUTH_BY_CREDS_FAILURE")(),_=Object(f.createAsyncAction)("auth/REG_BY_CREDS_REQUEST","auth/REG_BY_CREDS_SUCCESS","auth/REG_BY_CREDS_FAILURE")(),E=Object(f.createAction)("auth/LOGOUT")(),O={authData:{authToken:null,id:"",login:"",error:null}},j=Object(f.createAsyncAction)("user/GET_USER_REQUEST","user/GET_USER_SUCCESS","user/GET_USER_FAILURE")(),y=Object(f.createAsyncAction)("media/UPDATE_AVATAR_REQUEST","media/UPDATE_AVATAR_SUCCESS","media/UPDATE_AVATAR_FAILURE")(),k={error:null,userData:{_id:"",createdAt:"",login:"",nick:"",avatar:{_id:"",url:""},chats:[]}},x=a(68),C=Object(f.createAsyncAction)("contacts/GET_CONTACTS_REQUEST","contacts/GET_CONTACTS_SUCCESS","contacts/GET_CONTACTS_FAILURE")(),S={error:null,contactsData:[]},w=Object(f.createAsyncAction)("chat/GET_ACTIVE_CHAT_REQUEST","chat/GET_ACTIVE_CHAT_SUCCESS","chat/GET_ACTIVE_CHAT_FAILURE")(),A=Object(f.createAsyncAction)("chat/ADD_CHAT_REQUEST","chat/ADD_CHAT_SUCCESS","chat/ADD_CHAT_FAILURE")(),T={activeChatId:null,activeChatName:"Chat",error:null,chatData:{_id:"",owner:{_id:"",login:"",nick:"",avatar:{_id:"",url:""}},title:"",createdAt:"",members:[],messages:[],avatar:{_id:"",url:""}}},U=Object(f.createAsyncAction)("message/SEND_MESSAGE_REQUEST","message/SEND_MESSAGE_SUCCESS","message/SEND_MESSAGE_FAILURE")(),D=Object(f.createAction)("message/ON_MESSAGE",(function(e){return e}))(),N={error:null,messageData:{_id:"",createdAt:"",owner:{_id:"",login:"",nick:"",avatar:{_id:"",url:""}},chat:{_id:"",owner:{_id:"",login:"",nick:"",avatar:{_id:"",url:""}},title:"",createdAt:"",members:[],messages:[],avatar:{_id:"",url:""}},text:""}},I=Object(f.createAsyncAction)("media/UPLOAD_AVATAR_REQUEST","media/UPLOAD_AVATAR_SUCCESS","media/UPLOAD_AVATAR_FAILURE")(),B={error:null,avatarData:{_id:"",url:""},mediaData:{_id:"",createdAt:"",owner:{_id:"",login:"",nick:"",avatar:{_id:"",url:""}},text:"",url:"",originalFileName:"",type:"",userAvatar:{_id:"",login:"",nick:"",avatar:{_id:"",url:""}},chatAvatar:[],messages:[]}},R=Object(s.c)({router:Object(d.b)(h),auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Object(f.getType)(b.success):return Object(v.a)({},e,{authData:Object(v.a)({},e.authData,{authToken:t.payload.authToken,id:t.payload.id,login:t.payload.login,error:null})});case Object(f.getType)(b.failure):return Object(v.a)({},e,{authData:Object(v.a)({},e.authData,{authToken:null,error:t.payload})});default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Object(f.getType)(j.success):return Object(v.a)({},e,{error:null,userData:t.payload});case Object(f.getType)(j.failure):return Object(v.a)({},e,{error:t.payload});case Object(f.getType)(y.success):return Object(v.a)({},e,{error:null,userData:t.payload});case Object(f.getType)(y.failure):return Object(v.a)({},e,{error:t.payload});default:return e}},contacts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Object(f.getType)(C.success):return Object(v.a)({},e,{error:null,contactsData:[].concat(Object(x.a)(e.contactsData),Object(x.a)(t.payload))});case Object(f.getType)(C.failure):return Object(v.a)({},e,{contactsData:[],error:t.payload});default:return e}},chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Object(f.getType)(w.success):return Object(v.a)({},e,{activeChatId:t.payload.activeChatId,activeChatName:t.payload.activeChatName,error:null,chatData:t.payload.activeChat});case Object(f.getType)(w.failure):return Object(v.a)({},e,{error:t.payload});case Object(f.getType)(A.success):return Object(v.a)({},e,{activeChatId:t.payload.activeChatId,error:null,chatData:t.payload.newChat});case Object(f.getType)(A.failure):return Object(v.a)({},e,{error:t.payload});default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Object(f.getType)(U.success):return Object(v.a)({},e,{error:null,messageData:t.payload});case Object(f.getType)(U.failure):return Object(v.a)({},e,{error:t.payload});case Object(f.getType)(D):return Object(v.a)({},e,{error:null,messageData:t.payload});default:return e}},media:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Object(f.getType)(I.success):return Object(v.a)({},e,{error:null,avatarData:t.payload});case Object(f.getType)(I.failure):return Object(v.a)({},e,{error:t.payload});default:return e}}}),F=a(4),q=a.n(F),P=a(3),M=a(17),L=a(18),$=a(54),W=a.n($),H=function(){var e=Object(M.a)(q.a.mark((function e(t,a,n,r){var c,o;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"post",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:a},body:JSON.stringify({query:n,variables:r})});case 3:return c=e.sent,o=c.json(),e.abrupt("return",c.ok?o:new Error("Status is not 200"));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",new Error("dataPost failed"));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,a,n,r){return e.apply(this,arguments)}}(),Q=q.a.mark(V),G=q.a.mark(Z),Y=q.a.mark(K);function V(){var e,t,a,n,r,c,o,s,u,i;return q.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(!(e=localStorage.getItem("authToken"))){l.next=9;break}return t=W()(e),a=t.sub.id,n=t.sub.login,l.next=7,Object(P.d)(b.success({authToken:e,id:a,login:n}));case 7:return l.next=9,Object(P.c)(Object(L.d)("/profile"));case 9:return l.next=12,Object(P.g)(b.request);case 12:return r=l.sent,c=r.payload,console.log("authByCredsSaga -> payload",c),l.prev=15,l.next=18,Object(P.b)(J,c.login,c.password);case 18:if(o=l.sent,console.log("authByCredsSaga -> authToken",o),!o){l.next=31;break}return s=W()(o),u=s.sub.id,i=s.sub.login,localStorage.setItem("authToken",o),l.next=27,Object(P.d)(b.success({authToken:o,id:u,login:i}));case 27:return l.next=29,Object(P.c)(Object(L.d)("/profile"));case 29:l.next=33;break;case 31:return l.next=33,Object(P.c)(b.failure("Wrong login or password"));case 33:l.next=40;break;case 35:return l.prev=35,l.t0=l.catch(15),console.error("authByCredsSaga -> error",l.t0),l.next=40,Object(P.c)(b.failure(l.t0.message));case 40:l.next=9;break;case 42:case"end":return l.stop()}}),Q,null,[[15,35]])}var J=function(){var e=Object(M.a)(q.a.mark((function e(t,a){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,1e3)}));case 2:return e.next=4,H("http://chat.fs.a-level.com.ua/graphql","","query log ($login:String, $password:String) {\n        login(login:$login, password:$password)\n    }",{login:t,password:a});case 4:return n=e.sent,e.abrupt("return",n.data.login);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function Z(){var e,t,a,n,r,c,o;return q.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=3,Object(P.g)(_.request);case 3:return e=s.sent,t=e.payload,console.log("regByCredsSaga -> payload",t),s.prev=6,s.next=9,Object(P.b)(z,t.nick,t.login,t.password);case 9:return a=s.sent,console.log("regByCredsSaga -> user",a),s.next=13,Object(P.b)(J,t.login,t.password);case 13:if(n=s.sent,console.log("regByCredsSaga -> authToken",n),!n){s.next=26;break}return r=W()(n),c=r.sub.id,o=r.sub.login,localStorage.setItem("authToken",n),s.next=22,Object(P.d)(b.success({authToken:n,id:c,login:o}));case 22:return s.next=24,Object(P.c)(Object(L.d)("/profile"));case 24:s.next=28;break;case 26:return s.next=28,Object(P.c)(b.failure("Wrong login or password"));case 28:s.next=35;break;case 30:return s.prev=30,s.t0=s.catch(6),console.error(s.t0),s.next=35,Object(P.c)(_.failure(s.t0.message));case 35:s.next=0;break;case 37:case"end":return s.stop()}}),G,null,[[6,30]])}var z=function(){var e=Object(M.a)(q.a.mark((function e(t,a,n){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,1e3)}));case 2:return e.next=4,H("http://chat.fs.a-level.com.ua/graphql","","mutation reg($nick:String, $login:String, $password:String) {\n    UserUpsert(user: {nick:$nick, login:$login, password:$password}) {\n        _id createdAt login nick\n        avatar{\n            _id, url\n        }\n    }\n}",{nick:t,login:a,password:n});case 4:return r=e.sent,e.abrupt("return",r.data.UserUpsert);case 6:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}();function K(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,Object(P.g)(E);case 3:return localStorage.clear(),e.next=6,Object(P.c)(Object(L.d)("/sign-in"));case 6:e.next=0;break;case 8:case"end":return e.stop()}}),Y)}var X=q.a.mark(te),ee=q.a.mark(ne);function te(){var e,t;return q.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=3,Object(P.g)(j.request);case 3:return console.log("getUserSaga"),a.prev=4,a.next=7,Object(P.e)((function(e){return e.auth.authData.id}));case 7:return e=a.sent,a.next=10,Object(P.b)(ae,e);case 10:return t=a.sent,console.log("getUserSaga -> user",t),a.next=14,Object(P.d)(j.success(t));case 14:a.next=21;break;case 16:return a.prev=16,a.t0=a.catch(4),console.error("getUserSaga -> error",a.t0),a.next=21,Object(P.c)(j.failure(a.t0.message));case 21:a.next=0;break;case 23:case"end":return a.stop()}}),X,null,[[4,16]])}var ae=function(){var e=Object(M.a)(q.a.mark((function e(t){var a,n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a='[{"_id": "'.concat(t,'"}]'),e.next=3,H("http://chat.fs.a-level.com.ua/graphql","Bearer ".concat(localStorage.authToken),"query getUsers($userQuery: String){\n  UserFindOne(query: $userQuery){\n    _id\n    login\n    nick\n    createdAt\n    avatar{\n      _id, url\n    }\n    chats{\n      _id\n      createdAt\n      title\n      owner{\n        _id login nick\n        avatar{\n          _id, url\n        }\n      }\n      members{\n        _id login nick\n        avatar{\n          _id, url\n        }\n      }\n      messages{\n        _id createdAt text\n        owner{\n          _id login nick\n          avatar{\n            _id, url\n          }\n        }\n      }\n      avatar{\n        _id, url\n      }\n    }\n  }\n}",{userQuery:a});case 3:return n=e.sent,console.log(n.data),e.abrupt("return",n.data.UserFindOne);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function ne(){var e,t,a;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=3,Object(P.g)(y.request);case 3:return e=n.sent,t=e.payload,console.log("updateAvatarSaga",t),n.prev=6,n.next=9,Object(P.b)(re,t.user_id,t.image_id);case 9:return a=n.sent,console.log("updateAvatarSaga -> userData",a),n.next=13,Object(P.d)(y.success(a));case 13:n.next=20;break;case 15:return n.prev=15,n.t0=n.catch(6),console.error("updateAvatarSaga -> error",n.t0),n.next=20,Object(P.c)(y.failure(n.t0.message));case 20:n.next=0;break;case 22:case"end":return n.stop()}}),ee,null,[[6,15]])}var re=function(){var e=Object(M.a)(q.a.mark((function e(t,a){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H("http://chat.fs.a-level.com.ua/graphql","Bearer ".concat(localStorage.authToken),"mutation updateAvatar($user_id: ID, $image_id: ID) {\n  UserUpsert(user: {_id: $user_id, \n    avatar: {_id: $image_id}}) {\n        _id\n    login\n    nick\n    createdAt\n    avatar {\n      _id\n      url\n    }\n    chats {\n      _id\n      createdAt\n      owner {\n        _id\n        login\n        nick\n      }\n      title\n      members {\n        _id\n        login\n        nick\n      }\n      messages {\n        _id\n        createdAt\n        text\n        owner {\n          _id\n          login\n          nick\n        }\n      }\n    }\n  }\n}",{user_id:t,image_id:a});case 2:return n=e.sent,console.log("userContent.data.UserUpsert",n.data.UserUpsert),e.abrupt("return",n.data.UserUpsert);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),ce=q.a.mark(oe);function oe(){var e;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Object(P.g)(C.request);case 3:return console.log("getContactsSaga"),t.prev=4,t.next=7,Object(P.b)(se);case 7:return e=t.sent,console.log("getContactsSaga -> \u0441ontacts",e),t.next=11,Object(P.d)(C.success(e));case 11:t.next=18;break;case 13:return t.prev=13,t.t0=t.catch(4),console.error("getContactsSaga -> error",t.t0),t.next=18,Object(P.c)(C.failure(t.t0.message));case 18:t.next=0;break;case 20:case"end":return t.stop()}}),ce,null,[[4,13]])}var se=function(){var e=Object(M.a)(q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H("http://chat.fs.a-level.com.ua/graphql","Bearer ".concat(localStorage.authToken),'query users {\n  UserFind(query:"[{}]"){\n    _id\n    login\n    nick\n    createdAt\n    avatar{\n      _id, url\n    }\n  }\n}');case 2:return t=e.sent,console.log(t.data),e.abrupt("return",t.data.UserFind);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=q.a.mark(le),ie=q.a.mark(pe);function le(){var e,t,a,n,r,c;return q.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=3,Object(P.g)(w.request);case 3:return e=o.sent,t=e.payload,console.log("getActiveChatSaga"),o.prev=6,o.next=9,Object(P.e)((function(e){return e.auth.authData.id}));case 9:return a=o.sent,o.next=12,Object(P.b)(de,t);case 12:return n=o.sent,console.log("getActiveChatSaga -> activeChat",n),r=n._id,o.next=17,Object(P.b)(me,n,a);case 17:return c=o.sent,o.next=20,Object(P.d)(w.success({activeChat:n,activeChatId:r,activeChatName:c}));case 20:o.next=27;break;case 22:return o.prev=22,o.t0=o.catch(6),console.error("getActiveChatSaga -> error",o.t0),o.next=27,Object(P.c)(w.failure(o.t0.message));case 27:o.next=0;break;case 29:case"end":return o.stop()}}),ue,null,[[6,22]])}var de=function(){var e=Object(M.a)(q.a.mark((function e(t){var a,n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a='[{"_id": "'.concat(t,'"}]'),e.next=3,H("http://chat.fs.a-level.com.ua/graphql","Bearer ".concat(localStorage.authToken),"query getActiveChat($chatQuery: String){\n  ChatFindOne(query: $chatQuery){\n    _id title createdAt\n    owner {\n      _id login nick\n      avatar{\n        _id, url\n      }\n    }\n        avatar{\n      _id, url\n    }\n    members{\n      _id login nick\n      avatar{\n        _id, url\n      }\n    }\n    messages{\n      _id text createdAt \n      owner{\n        _id\n      }\n    }\n  }\n}",{chatQuery:a});case 3:return n=e.sent,console.log("chatContent.data.ChatFindOne",n.data.ChatFindOne),e.abrupt("return",n.data.ChatFindOne);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),me=function(e,t){if(e.title)return e.title;var a=e.members.find((function(e){return e._id!==t}));return console.log("member",a),a&&(a.nick?a.nick:a.login)};function pe(){var e,t,a,n,r,c,o;return q.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=3,Object(P.g)(A.request);case 3:return e=s.sent,t=e.payload,console.log("addChatSaga"),s.prev=6,s.next=9,Object(P.e)((function(e){return e.auth.authData.id}));case 9:return a=s.sent,s.next=12,Object(P.b)(ge,a,t);case 12:return n=s.sent,console.log("addChatSaga -> newChat",n),r=n._id,s.next=17,Object(P.d)(A.success({newChat:n,activeChatId:r}));case 17:return s.next=19,Object(P.b)(de,r);case 19:return c=s.sent,s.next=22,Object(P.b)(me,c,a);case 22:return o=s.sent,s.next=25,Object(P.d)(w.success({activeChat:c,activeChatId:r,activeChatName:o}));case 25:s.next=32;break;case 27:return s.prev=27,s.t0=s.catch(6),console.error("addChatSaga -> error",s.t0),s.next=32,Object(P.c)(A.failure(s.t0.message));case 32:s.next=0;break;case 34:case"end":return s.stop()}}),ie,null,[[6,27]])}var ge=function(){var e=Object(M.a)(q.a.mark((function e(t,a){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H("http://chat.fs.a-level.com.ua/graphql","Bearer ".concat(localStorage.authToken),"mutation addChat ($firstMember_id:ID, $secondMember_id:ID)  {\n  ChatUpsert(chat: {   \n\t\tmembers: [\n      {_id: $firstMember_id}, {_id: $secondMember_id}\n    ]}) {\n    _id\n    members {\n      _id\n      login\n      nick\n    }\n    messages {\n      _id\n      createdAt\n      text\n      owner {\n        _id\n        login\n        nick\n      }\n    }\n  }\n}",{firstMember_id:t,secondMember_id:a});case 2:return n=e.sent,console.log("chatContent.data.ChatUpsert",n.data.ChatUpsert),e.abrupt("return",n.data.ChatUpsert);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),he=q.a.mark(fe),ve=q.a.mark(_e);function fe(){var e,t,a;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=3,Object(P.g)(U.request);case 3:return e=n.sent,t=e.payload,console.log("sendMessageSaga"),n.prev=6,n.next=9,Object(P.b)(be,t.activeChatId,t.text);case 9:return a=n.sent,console.log("sendMessageSaga -> message",a),n.next=13,Object(P.d)(U.success(a));case 13:n.next=20;break;case 15:return n.prev=15,n.t0=n.catch(6),console.error("sendMessageSaga -> error",n.t0),n.next=20,Object(P.c)(U.failure(n.t0.message));case 20:n.next=0;break;case 22:case"end":return n.stop()}}),he,null,[[6,15]])}var be=function(){var e=Object(M.a)(q.a.mark((function e(t,a){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H("http://chat.fs.a-level.com.ua/graphql","Bearer ".concat(localStorage.authToken),"mutation sendMessage ($chat_id:ID, $text:String) {\n  MessageUpsert(message: {\n      chat: {_id: $chat_id}, \n      text: $text\n  }) {\n    _id\n    createdAt\n    text\n    owner {\n      _id\n      login\n      nick\n    }\n  }\n}",{chat_id:t,text:a});case 2:return n=e.sent,console.log("chat_id",t,"text",a),console.log("messageContent.data.MessageUpsert",n.data.MessageUpsert),e.abrupt("return",n.data.MessageUpsert);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function _e(){var e,t,a;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=3,Object(P.g)(D);case 3:return e=n.sent,t=e.payload,console.log("msg",t),n.next=8,Object(P.e)((function(e){return e.chat.activeChatId}));case 8:return a=n.sent,n.next=11,Object(P.c)(w.request(a));case 11:n.next=0;break;case 13:case"end":return n.stop()}}),ve)}var Ee=q.a.mark(Oe);function Oe(){var e,t,a;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=3,Object(P.g)(I.request);case 3:return e=n.sent,t=e.payload,console.log("uploadAvatarSaga",t.form),n.prev=6,n.next=9,Object(P.b)(je,t);case 9:return a=n.sent,console.log("uploadAvatarSaga -> image",a),n.next=13,Object(P.d)(I.success(a));case 13:n.next=20;break;case 15:return n.prev=15,n.t0=n.catch(6),console.error("uploadAvatarSaga -> error",n.t0),n.next=20,Object(P.c)(I.failure(n.t0.message));case 20:n.next=0;break;case 22:case"end":return n.stop()}}),Ee,null,[[6,15]])}var je=function(){var e=Object(M.a)(q.a.mark((function e(t){var a,n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log(t),e.next=4,fetch("http://chat.fs.a-level.com.ua/upload",{method:"POST",headers:localStorage.authToken?{Authorization:"Bearer "+localStorage.authToken}:{},body:new FormData(t)});case 4:return a=e.sent,console.log(a),n=a.json(),e.abrupt("return",a.ok?n:new Error("status is not 200"));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",new Error("dataPost failed"));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),ye=q.a.mark(ke);function ke(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(P.a)([Object(P.f)(V),Object(P.f)(Z),Object(P.f)(te),Object(P.f)(oe),Object(P.f)(le),Object(P.f)(fe),Object(P.f)(pe),Object(P.f)(K),Object(P.f)(_e),Object(P.f)(Oe),Object(P.f)(ne)]);case 2:case"end":return e.stop()}}),ye)}var xe=a(23),Ce=a(25),Se=a(40),we=a(65),Ae=a.n(we),Te=Object(u.c)(null,(function(e){return Object(s.b)({regByCreds:_.request},e)}))(r.a.memo((function(e){var t=e.regByCreds,a=r.a.useState(""),n=Object(Ce.a)(a,2),c=n[0],o=n[1],s=r.a.useState(""),u=Object(Ce.a)(s,2),i=u[0],l=u[1],d=r.a.useState(""),m=Object(Ce.a)(d,2),p=m[0],g=m[1];return r.a.createElement("form",{action:"",onSubmit:function(e){e.preventDefault(),t({nick:c,login:i,password:p})},className:Ae.a.loginForm},r.a.createElement("label",{htmlFor:"nick"},"Nick"),r.a.createElement("input",{type:"text",id:"nick",required:!0,value:c,onChange:function(e){return o(e.target.value)}}),r.a.createElement("label",{htmlFor:"login"},"Login"),r.a.createElement("input",{type:"text",id:"login",required:!0,value:i,onChange:function(e){return l(e.target.value)}}),r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",id:"password",required:!0,value:p,onChange:function(e){return g(e.target.value)}}),r.a.createElement("div",{className:Ae.a.buttonBlock},r.a.createElement("button",{type:"submit"},"Sign Up")),r.a.createElement("p",null,r.a.createElement(Se.a,{to:"/sign-in"},"Sign In")))}))),Ue=a(66),De=a.n(Ue),Ne=Object(u.c)(null,(function(e){return Object(s.b)({authByCreds:b.request},e)}))(r.a.memo((function(e){var t=e.authByCreds,a=r.a.useState(""),n=Object(Ce.a)(a,2),c=n[0],o=n[1],s=r.a.useState(""),u=Object(Ce.a)(s,2),i=u[0],l=u[1];return r.a.createElement("form",{action:"",onSubmit:function(e){e.preventDefault(),t({login:c,password:i})},className:De.a.loginForm},r.a.createElement("label",{htmlFor:"login"},"Login"),r.a.createElement("input",{type:"text",id:"login",required:!0,value:c,onChange:function(e){return o(e.target.value)}}),r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",id:"password",required:!0,value:i,onChange:function(e){return l(e.target.value)}}),r.a.createElement("div",{className:De.a.buttonBlock},r.a.createElement("button",{type:"submit"},"Sign In")),r.a.createElement("p",null,"New to Chat? ",r.a.createElement(Se.a,{to:"/registration"},"Join now")))}))),Ie=a(88),Be=a.n(Ie),Re=a(89),Fe=a.n(Re),qe=(a(139),a(140),r.a.memo((function(e){return r.a.createElement("div",{className:"User",onClick:e.onClick},r.a.createElement("img",{src:e.avatarSrc,alt:"avatar",className:"UserImg"}),r.a.createElement("div",{className:"UserDetails"},r.a.createElement("p",{className:"UseDetailsName"},e.name)))}))),Pe=a(26),Me=a.n(Pe),Le=a(33),$e=a(34),We=a(36),He=a(37),Qe=a(24),Ge=a(19),Ye=a.n(Ge),Ve=function(e){Object(He.a)(a,e);var t=Object(We.a)(a);function a(){var e;Object(Le.a)(this,a);for(var n=arguments.length,c=new Array(n),o=0;o<n;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={isOpenedPopup:!1,isAvatarUpload:!1},e.myRef=r.a.createRef(),e.myFormRef=r.a.createRef(),e.closePopup=function(t){console.log(e.myRef),e.myRef.current&&!e.myRef.current.contains(t.target)&&(console.log("TCL: Button -> closePopup -> event",t),e.setState({isOpenedPopup:!1}))},e.togglePopup=function(){e.setState({isOpenedPopup:!e.state.isOpenedPopup})},e.uploadAvatar=function(t){e.props.uploadAvatar(t),e.setState({isAvatarUpload:!e.state.isAvatarUpload})},e.updateAvatar=function(t,a){e.props.updateAvatar({user_id:t,image_id:a})},e.logoutHandler=function(){e.props.logout()},e}return Object($e.a)(a,[{key:"componentDidUpdate",value:function(e,t){t.isOpenedPopup!==this.state.isOpenedPopup&&(this.state.isOpenedPopup?(console.log("addEventListener",t),document.addEventListener("click",this.closePopup)):(console.log("removeEventListener"),document.removeEventListener("click",this.closePopup)))}},{key:"render",value:function(){var e=this,t=this.state,a=t.isOpenedPopup,n=t.isAvatarUpload;return r.a.createElement("div",{className:Ye.a.buttonWithPopup},r.a.createElement("button",{onClick:this.togglePopup,className:Ye.a.navOpener},r.a.createElement(Qe.a,{icon:"bars"})),a&&r.a.createElement("div",{ref:this.myRef,className:Ye.a.popup},r.a.createElement("div",{className:Ye.a.popupHeader},r.a.createElement("img",{src:this.props.avatar}),r.a.createElement("form",{className:Ye.a.uploadForm,ref:this.myFormRef,method:"post",action:"/upload",encType:"multipart/form-data",id:"form"},r.a.createElement("div",{className:Ye.a.uploadBtnWrapper},r.a.createElement("button",{className:Ye.a.changeButton},"Change avatar"),r.a.createElement("input",{className:Ye.a.uploadInput,type:"file",name:"media",id:"media",onChange:function(){e.myFormRef.current&&e.uploadAvatar(e.myFormRef.current)}}))),n&&r.a.createElement("button",{className:Ye.a.okButton,onClick:function(){return e.updateAvatar(e.props.activeUserId,e.props.imageId)}},"Ok")),r.a.createElement("nav",{className:Ye.a.navSidebar},r.a.createElement("ul",{className:Ye.a.navList},r.a.createElement("li",{className:Ye.a.navItem},r.a.createElement(Qe.a,{icon:"user-friends"}),"Contacts"),r.a.createElement("li",{className:Ye.a.navItem},r.a.createElement(Qe.a,{icon:"comments"}),"Chats"),r.a.createElement("li",{onClick:function(){return e.logoutHandler()},className:Ye.a.navItem},r.a.createElement(Qe.a,{icon:"sign-out-alt"}),"Exit")))))}}]),a}(r.a.PureComponent),Je=Object(u.c)((function(e){return{activeUserId:e.user.userData._id,avatar:e.user.userData.avatar?"http://chat.fs.a-level.com.ua/".concat(e.user.userData.avatar.url):Me.a,imageId:e.media.avatarData._id}}),(function(e){return Object(s.b)({logout:E,uploadAvatar:I.request,updateAvatar:y.request},e)}))(Ve),Ze=Object(u.c)((function(e){return{activeUserId:e.user.userData._id,contacts:e.contacts.contactsData,chats:e.user.userData.chats}}),(function(e){return Object(s.b)({getContacts:C.request,getActiveChat:w.request,addChat:A.request},e)}))(r.a.memo((function(e){r.a.useEffect((function(){localStorage.getItem("authToken")&&e.getContacts()}),[]);var t=function(t){if(1===t.members.length)return{name:"You",avatar:t.avatar?"http://chat.fs.a-level.com.ua/".concat(t.avatar.url):Me.a};if(t.members.length>2)return{name:t.title?t.title:"Group",avatar:t.avatar?"http://chat.fs.a-level.com.ua/".concat(t.avatar.url):Me.a};var a=t.members.find((function(t){return t._id!==e.activeUserId})),n=a&&a.avatar&&"http://chat.fs.a-level.com.ua/".concat(a.avatar.url);return{name:a&&(a.nick?a.nick:a.login),avatar:t.avatar?"http://chat.fs.a-level.com.ua/".concat(t.avatar.url):n||Me.a}},a=function(t){var a=[];return e.chats.map((function(e){2===e.members.length&&e.members.forEach((function(n){n._id===t&&a.push(e._id)}))})),a};return r.a.createElement("aside",{className:"sidebar"},r.a.createElement(Je,null),e.chats&&e.chats.length?r.a.createElement(r.a.Fragment,null,e.chats.map((function(a){return r.a.createElement(qe,{key:a._id,name:t(a).name,avatarSrc:t(a).avatar,onClick:function(){return t=a._id,void e.getActiveChat(t);var t}})}))):r.a.createElement(r.a.Fragment,null,e.contacts.map((function(t){return r.a.createElement(qe,{key:t.login,name:t.nick?t.nick:t.login,avatarSrc:t.avatar?"http://chat.fs.a-level.com.ua/".concat(t.avatar.url):Me.a,onClick:function(){return n=t._id,void(a(n).length?e.getActiveChat(a(n)[0]):e.addChat(n));var n}})}))))}))),ze=(a(141),a(142),function(e){return r.a.createElement("div",{className:"empty"},r.a.createElement("h1",{className:"emptyName"},"Welcome, ",e.name," "),r.a.createElement("img",{src:e.avatarSrc,alt:e.name,className:"avatar"}),r.a.createElement("p",{className:"emptyInfo"},"Please select a chat to start messaging"))});a(143);var Ke=r.a.memo((function(e){return r.a.createElement("header",{className:"header"},r.a.createElement("h1",{className:"headerName"},e.userName),r.a.createElement("button",{className:"deleteButton"},"..."))})),Xe=(a(144),a(90)),et=(a(145),function(e){Object(He.a)(a,e);var t=Object(We.a)(a);function a(e){var n;return Object(Le.a)(this,a),(n=t.call(this,e)).chatsRef=void 0,n.scrollToBottom=function(){n.chatsRef.current&&(n.chatsRef.current.scrollTop=n.chatsRef.current.scrollHeight)},n.chatsRef=r.a.createRef(),n}return Object($e.a)(a,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"isUserMsg",value:function(e){return e.owner._id===this.props.activeUserId}},{key:"getTime",value:function(e){var t=new Date(e),a=this.getFormattedTime(t.getHours()),n=this.getFormattedTime(t.getMinutes());return"".concat(a,":").concat(n)}},{key:"getFormattedTime",value:function(e){return e<10?"0".concat(e):e}},{key:"getFormattedMessage",value:function(e){var t=e.match(/http(?:s?):\/\/(?:www\.)?youtu(?:be\.com\/watch\?v=|\.be\/)([\w\-\_]*)(&(amp;)?\u200c [\w\?\u200c =]*)?/);if(t){var a=t&&t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:e},e),r.a.createElement(Xe.a,{url:"https://www.youtube.com/embed/".concat(a),width:"100%",frameBorder:0,allow:"accelerometer",allowFullScreen:!0,"encrypted-media":!0,"picture-in-picture":!0}))}return e}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"Chats",ref:this.chatsRef},this.props.messages&&this.props.messages.map((function(t){return r.a.createElement("div",{key:t._id,className:'"Message_input_box" Chat '.concat(e.isUserMsg(t)?"is-user-msg":""),"data-name":e.isUserMsg(t)?"You ":e.props.activeChatName,"data-user":e.isUserMsg(t),"data-text":t.text,"data-number":t._id},e.getFormattedMessage(t.text),r.a.createElement("div",{className:"timeBlock"},e.getTime(+t.createdAt)),r.a.createElement("button",{"data-number":t._id,className:"Chat_delete_button"},"x"))})))}}]),a}(r.a.PureComponent)),tt=Object(u.c)((function(e){return{activeUserId:e.user.userData._id,nick:e.user.userData.nick,activeChat:e.chat.chatData,activeChatName:e.chat.activeChatName,messages:e.chat.chatData?e.chat.chatData.messages:[]}}),null)(et),at=(a(84),a(91)),nt=a(67),rt=a.n(nt),ct=function(e){Object(He.a)(a,e);var t=Object(We.a)(a);function a(e){var n;return Object(Le.a)(this,a),(n=t.call(this,e)).myRef=r.a.createRef(),n.closeEmoji=function(e){console.log(n.myRef),n.myRef.current&&!n.myRef.current.contains(e.target)&&(console.log("TCL: Button -> closeSmiles -> event",e),n.setState({isOpenedEmoji:!1}))},n.toggleEmoji=function(){n.setState({isOpenedEmoji:!n.state.isOpenedEmoji})},n.state={isOpenedEmoji:!1,emojiObj:""},n}return Object($e.a)(a,[{key:"componentDidUpdate",value:function(e,t){t.isOpenedEmoji!==this.state.isOpenedEmoji&&(this.state.isOpenedEmoji?(console.log("addEventListener",t),document.addEventListener("click",this.closeEmoji)):(console.log("removeEventListener"),document.removeEventListener("click",this.closeEmoji)))}},{key:"render",value:function(){var e=this,t=this.state.isOpenedEmoji;return r.a.createElement("div",{className:rt.a.buttonWithEmoji},r.a.createElement("button",{onClick:this.toggleEmoji},r.a.createElement(Qe.a,{icon:"smile"})),t&&r.a.createElement("div",{ref:this.myRef,className:rt.a.emojiBlock},r.a.createElement(at.a,{set:"google",onSelect:function(t){e.props.addEmoji(t),console.log(t)}})))}}]),a}(r.a.PureComponent),ot=a(38),st=a.n(ot),ut=Object(u.c)((function(e){return{activeChatId:e.chat.activeChatId}}),(function(e){return Object(s.b)({sendMessage:U.request},e)}))(r.a.memo((function(e){var t=e.sendMessage,a=e.activeChatId,n=r.a.useState(""),c=Object(Ce.a)(n,2),o=c[0],s=c[1],u=r.a.useState(null),i=Object(Ce.a)(u,2);i[0],i[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{action:"",onSubmit:function(e){e.preventDefault(),""!==o.trim()&&(a&&t({activeChatId:a,text:o}),s(""))},className:st.a.message},r.a.createElement("input",{className:st.a.messageInput,placeholder:"write a message",type:"text",value:o,onChange:function(e){return s(e.target.value)}}),r.a.createElement(ct,{addEmoji:function(e){console.log("input",e),s(o+e.native)}}),r.a.createElement("div",{className:st.a.buttonBlock},r.a.createElement("div",{className:st.a.uploadBtnWrapper},r.a.createElement("button",null,r.a.createElement(Qe.a,{icon:"paperclip"})),r.a.createElement("input",{className:st.a.uploadInput,type:"file",name:"media",id:"media"})),r.a.createElement("button",{type:"submit"},r.a.createElement(Qe.a,{icon:"paper-plane"})))))}))),it=r.a.memo((function(e){return r.a.createElement("div",{className:"ChatWindow"},r.a.createElement(Ke,{userName:e.name}),r.a.createElement(tt,null),r.a.createElement(ut,null))})),lt=Object(u.c)((function(e){return{nick:e.user.userData.nick,login:e.user.userData.login,avatar:e.user.userData.avatar?"http://chat.fs.a-level.com.ua/".concat(e.user.userData.avatar.url):Me.a,activeChatId:e.chat.chatData._id,activeChatName:e.chat.activeChatName}}),(function(e){return Object(s.b)({getUser:j.request},e)}))(r.a.memo((function(e){return r.a.createElement("main",{className:"Main"},e.activeChatId?r.a.createElement(it,{name:e.activeChatName}):r.a.createElement(ze,{name:e.nick?e.nick:e.login,avatarSrc:e.avatar}))}))),dt=Object(u.c)(null,(function(e){return Object(s.b)({getUser:j.request,onMessage:D},e)}))(r.a.memo((function(e){return r.a.useEffect((function(){if(localStorage.getItem("authToken")){e.getUser();var t=Be()("http://chat.fs.a-level.com.ua/");t.emit("jwt",localStorage.authToken),t.on("jwt_ok",(function(e){return console.log(e)})),t.on("jwt_fail",(function(e){return console.log(e)})),t.on("msg",(function(t){e.onMessage(t)}))}}),[]),r.a.createElement("div",{className:Fe.a.profile},r.a.createElement(Ze,null),r.a.createElement(lt,null))}))),mt=Object(u.c)((function(e){return{authToken:e.auth.authData.authToken}}))(r.a.memo((function(e){var t=e.authToken;return r.a.createElement(xe.d,null,r.a.createElement(xe.b,{exact:!0,path:"/sign-in",component:Ne}),r.a.createElement(xe.b,{exact:!0,path:"/registration",component:Te}),!t&&r.a.createElement(xe.a,{from:"/",to:"/sign-in"}),r.a.createElement(xe.b,{exact:!0,path:"/profile",component:dt}),t&&r.a.createElement(xe.a,{from:"/",to:"/profile"}),r.a.createElement(xe.b,{path:"/",render:function(){return r.a.createElement("p",null,"Page Not Found")}}))})));m.b.add(p.f,p.d,p.c,p.a,p.g,p.b,p.e);var pt=Object(i.a)(),gt=Object(s.e)(R,Object(s.a)(Object(l.a)(h),pt));pt.run(ke);var ht=function(){return r.a.createElement(u.a,{store:gt},r.a.createElement(d.a,{history:h},r.a.createElement(mt,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ht,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},19:function(e,t,a){e.exports={buttonWithPopup:"style_buttonWithPopup__1lQAQ",navOpener:"style_navOpener__3Hw_I",popup:"style_popup__u9k-3",popupHeader:"style_popupHeader__2ZHlh",uploadForm:"style_uploadForm__jtt_q",uploadBtnWrapper:"style_uploadBtnWrapper__WEYDC",uploadInput:"style_uploadInput__3lZr2",changeButton:"style_changeButton__HqBnn",okButton:"style_okButton__1yZD1",navSidebar:"style_navSidebar__3o8Bs",navList:"style_navList__1QP6Z",navItem:"style_navItem__1zHpi"}},26:function(e,t,a){e.exports=a.p+"static/media/user_avatar.c3631c65.png"},38:function(e,t,a){e.exports={message:"style_message__yYnVw",messageInput:"style_messageInput__2lCn9",ButtonWithEmoji:"style_ButtonWithEmoji__2Pk_-",buttonBlock:"style_buttonBlock__g4UAK",uploadBtnWrapper:"style_uploadBtnWrapper__bhQkQ",uploadInput:"style_uploadInput__2F-YU"}},65:function(e,t,a){e.exports={loginForm:"style_loginForm__2koch",buttonBlock:"style_buttonBlock__1NK4c"}},66:function(e,t,a){e.exports={loginForm:"style_loginForm__1OWHJ",buttonBlock:"style_buttonBlock__3Jk58"}},67:function(e,t,a){e.exports={buttonWithEmoji:"style_buttonWithEmoji__1MOip",emojiBlock:"style_emojiBlock__3BsgC"}},89:function(e,t,a){e.exports={profile:"style_profile__2a_cU"}},93:function(e,t,a){e.exports=a(147)},98:function(e,t,a){}},[[93,1,2]]]);
//# sourceMappingURL=main.cd5da13b.chunk.js.map